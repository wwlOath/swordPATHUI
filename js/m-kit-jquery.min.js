/*! m-kit 2021-05-21 11:24:05 */

!function() {
  function t(t) {
    var e, n, i;
    return this.length ? ((e = this[0]).ownerDocument ? i = e.ownerDocument : e = (i = e).documentElement,
        null == t ? i.exitFullscreen || i.webkitExitFullscreen || i.webkitCancelFullScreen || i.msExitFullscreen || i.mozCancelFullScreen ? (t = !!(i.fullscreenElement || i.msFullscreenElement || i.webkitIsFullScreen || i.mozFullScreen)) && (i.fullscreenElement || i.webkitFullscreenElement || i.webkitCurrentFullScreenElement || i.msFullscreenElement || i.mozFullScreenElement) || t : null : (t ? (n = e.requestFullscreen || e.webkitRequestFullscreen || e.webkitRequestFullScreen || e.msRequestFullscreen || e.mozRequestFullScreen) && n.call(e) : (n = i.exitFullscreen || i.webkitExitFullscreen || i.webkitCancelFullScreen || i.msExitFullscreen || i.mozCancelFullScreen) && n.call(i),
            this)) : this
  }
  function e(t) {
    jQuery(document).trigger(new jQuery.Event("fullscreenchange"))
  }
  function n(t) {
    jQuery(document).trigger(new jQuery.Event("fullscreenerror"))
  }
  var i, r, s;
  jQuery.fn.fullScreen = t,
      jQuery.fn.toggleFullScreen = function() {
        return t.call(this, !t.call(this))
      }
      ,
      s = (i = document).webkitCancelFullScreen ? (r = "webkitfullscreenchange",
          "webkitfullscreenerror") : i.msExitFullscreen ? (r = "MSFullscreenChange",
          "MSFullscreenError") : i.mozCancelFullScreen ? (r = "mozfullscreenchange",
          "mozfullscreenerror") : (r = "fullscreenchange",
          "fullscreenerror"),
      jQuery(document).bind(r, e),
      jQuery(document).bind(s, n)
}(),
    function(c, i, r, h) {
      var s = c(i);
      c.fn.lazyload = function(t) {
        var e, a = this, l = {
          threshold: 0,
          failure_limit: 0,
          event: "scroll",
          effect: "show",
          container: i,
          data_attribute: "original",
          skip_invisible: !0,
          appear: null,
          load: null,
          error: null,
          proxy_url: "/MoticKit/Utils/Proxy?url=",
          placeholder: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"
        };
        function n() {
          var e = 0;
          a.each(function() {
            var t = c(this);
            if (!l.skip_invisible || t.is(":visible"))
              if (c.abovethetop(this, l) || c.leftofbegin(this, l))
                ;
              else if (c.belowthefold(this, l) || c.rightoffold(this, l)) {
                if (++e > l.failure_limit)
                  return !1
              } else
                t.trigger("appear"),
                    e = 0
          })
        }
        function u(t) {
          var e = t.indexOf("://");
          return -1 !== e ? t.substring(0, t.indexOf("/", e + 3)) : 0 === t.indexOf("//") ? location.protocol + t.substring(0, t.indexOf("/", 2)) : ""
        }
        return t && (h !== t.failurelimit && (t.failure_limit = t.failurelimit,
            delete t.failurelimit),
        h !== t.effectspeed && (t.effect_speed = t.effectspeed,
            delete t.effectspeed),
            c.extend(l, t)),
            e = l.container === h || l.container === i ? s : c(l.container),
        0 === l.event.indexOf("scroll") && e.bind(l.event, function() {
          return n()
        }),
            this.each(function() {
              var r = this
                  , s = c(r)
                  , o = !1;
              r.loaded = !1,
              s.attr("src") !== h && !1 !== s.attr("src") || s.is("img") && s.attr("src", l.placeholder);
              var n = function() {
                if (!this.loaded) {
                  if (l.appear) {
                    var t = a.length;
                    l.appear.call(r, t, l)
                  }
                  c("<img />").bind("load", function() {
                    var t = this.src;
                    if (o) {
                      var e = s.attr("data-" + l.data_attribute);
                      sessionStorage.setItem("proxy_" + u(e), 1)
                    }
                    s.hide(),
                        s.is("img") ? s.attr("src", t) : s.css("background-image", "url('" + t + "')"),
                        s[l.effect](l.effect_speed),
                        r.loaded = !0;
                    var n = c.grep(a, function(t) {
                      return !t.loaded
                    });
                    if (a = c(n),
                        l.load) {
                      var i = a.length;
                      l.load.call(r, i, l)
                    }
                  }).bind("error", function(t) {
                    var e;
                    l.proxy_url && !o && (e = s.attr("data-" + l.data_attribute)) && -1 === u(e).indexOf(location.protocol + "//" + location.host) && (o = !0,
                        n.call(r, s, t)),
                    l.error && l.error.call(r, s, t)
                  }).attr("src", function() {
                    var t = s.attr("data-" + l.data_attribute);
                    return 0 === t.indexOf("//") && (t = location.protocol + t),
                    (o || sessionStorage.getItem("proxy_" + u(t))) && (t = l.proxy_url + encodeURIComponent(t)),
                        t
                  })
                }
              };
              s.one("appear", n),
              0 !== l.event.indexOf("scroll") && s.bind(l.event, function() {
                r.loaded || s.trigger("appear")
              })
            }),
            s.bind("resize", function() {
              n()
            }),
        /(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion) && s.bind("pageshow", function(t) {
          t.originalEvent && t.originalEvent.persisted && a.each(function() {
            c(this).trigger("appear")
          })
        }),
            c(r).ready(function() {
              n()
            }),
            this
      }
          ,
          c.belowthefold = function(t, e) {
            return (e.container === h || e.container === i ? (i.innerHeight ? i.innerHeight : s.height()) + s.scrollTop() : c(e.container).offset().top + c(e.container).height()) <= c(t).offset().top - e.threshold
          }
          ,
          c.rightoffold = function(t, e) {
            return (e.container === h || e.container === i ? s.width() + s.scrollLeft() : c(e.container).offset().left + c(e.container).width()) <= c(t).offset().left - e.threshold
          }
          ,
          c.abovethetop = function(t, e) {
            return (e.container === h || e.container === i ? s.scrollTop() : c(e.container).offset().top) >= c(t).offset().top + e.threshold + c(t).height()
          }
          ,
          c.leftofbegin = function(t, e) {
            return (e.container === h || e.container === i ? s.scrollLeft() : c(e.container).offset().left) >= c(t).offset().left + e.threshold + c(t).width()
          }
          ,
          c.inviewport = function(t, e) {
            return !(c.rightoffold(t, e) || c.leftofbegin(t, e) || c.belowthefold(t, e) || c.abovethetop(t, e))
          }
          ,
          c.extend(c.expr[":"], {
            "below-the-fold": function(t) {
              return c.belowthefold(t, {
                threshold: 0
              })
            },
            "above-the-top": function(t) {
              return !c.belowthefold(t, {
                threshold: 0
              })
            },
            "right-of-screen": function(t) {
              return c.rightoffold(t, {
                threshold: 0
              })
            },
            "left-of-screen": function(t) {
              return !c.rightoffold(t, {
                threshold: 0
              })
            },
            "in-viewport": function(t) {
              return c.inviewport(t, {
                threshold: 0
              })
            },
            "above-the-fold": function(t) {
              return !c.belowthefold(t, {
                threshold: 0
              })
            },
            "right-of-fold": function(t) {
              return c.rightoffold(t, {
                threshold: 0
              })
            },
            "left-of-fold": function(t) {
              return !c.rightoffold(t, {
                threshold: 0
              })
            }
          })
    }(jQuery, window, document),
    function(s) {
      var o = s.event.dispatch || s.event.handle
          , a = s.event.special
          , r = "D" + +new Date
          , n = "D" + (+new Date + 1);
      a.scrollstart = {
        setup: function(t) {
          var n, i = s.extend({
            latency: a.scrollstop.latency
          }, t), e = function(t) {
            var e = arguments;
            n ? clearTimeout(n) : (t.type = "scrollstart",
                o.apply(this, e)),
                n = setTimeout(function() {
                  n = null
                }, i.latency)
          };
          s(this).bind("scroll", e).data(r, e)
        },
        teardown: function() {
          s(this).unbind("scroll", s(this).data(r))
        }
      },
          a.scrollstop = {
            latency: 300,
            setup: function(t) {
              var i, r = s.extend({
                latency: a.scrollstop.latency
              }, t), e = function(t) {
                var e = this
                    , n = arguments;
                i && clearTimeout(i),
                    i = setTimeout(function() {
                      i = null,
                          t.type = "scrollstop",
                          o.apply(e, n)
                    }, r.latency)
              };
              s(this).bind("scroll", e).data(n, e)
            },
            teardown: function() {
              s(this).unbind("scroll", s(this).data(n))
            }
          }
    }(jQuery),
    function(l) {
      var o = "mCombox"
          , n = {
        locale: "zh_CN",
        inputClass: "",
        disabled: !1,
        placeholder: "",
        defaultId: null,
        value: null,
        notNull: !1,
        optBtn: null,
        replace: 1,
        origin: "",
        sourceUrl: "/Account/Dict"
      };
      function a(t, e) {
        this.items = [],
            this.elem = l(t),
            this.options = l.extend({}, n, e),
            this.init()
      }
      function u(t, e) {
        return '<li><a style="white-space: normal;cursor: pointer;" data-val="' + t + '">' + e + "</a></li>"
      }
      function c(t) {
        return '<li role="separator" class="divider"><span>' + t + "</span></li>"
      }
      function h(t, e) {
        t.style.height = "1px",
            t.style.height = (t.scrollHeight || 39) + (e ? 2 : 22) + "px"
      }
      l("head").append('<style type="text/css">@charset "UTF-8";.combox-option li.divider{display: none} .combox-option li+li.divider{display: block}</style>'),
          a.prototype = {
            init: function() {
              if (1 === this.options.replace) {
                var t = this.elem.attr("data-replace");
                "true" == t ? this.options.replace = !0 : "false" == t && (this.options.replace = !1)
              }
              var a = this
                  , e = l('<div style="position: relative" class="combox-group"><textarea  style="width: 100%;resize: none;" placeholder="' + this.options.placeholder + '" class="' + this.options.inputClass + '"></textarea>        <span style="position: absolute;bottom: 0;right: 0;padding: 0 8px 6px;cursor: pointer;display: none;font-weight: bold;font-size: 110%;">...</span></div>');
              !function(t, e, n) {
                var i = {
                  account: "/Account/Login"
                }
                    , r = document.getElementById("login_iframe_" + t);
                if (r)
                  return r.callbacks.push(e),
                  r.login && s(r.callbacks);
                function s(t) {
                  for (var e = 0; e < t.length; e++)
                    t[e]();
                  t.length = 0
                }
                (r = l("<iframe style='display: none'></iframe>").attr("id", "login_iframe_" + t).bind("load", function() {
                  -1 < this.src.indexOf(i[t]) && (r.login = !0,
                      s(r.callbacks))
                }).appendTo("body").attr("src", (n || "") + i[t])[0]).callbacks = [e]
              }("account", function() {
                a._loadRemote(function(t) {
                  var e = ""
                      , n = "name_" + a.options.locale;
                  e += c("title");
                  for (var i = 0; i < t.length; i++)
                    e += u(t[i].id, t[i][n]),
                        a._checkAndSetDefault(t[i].id, t[i][n]);
                  if (a.options.notNull && null === a.options.value && 0 < t.length) {
                    var r = t[0].id
                        , s = t[0][n];
                    setTimeout(function() {
                      a.textarea.val(s).trigger("propertychange", r)
                    }, 1)
                  }
                  a.menu.find("ul").append(e),
                  0 < t.length && a.btn.show()
                })
              }, this.options.origin),
                  this.elem.after(e).hide(),
                  this.textarea = e.find("textarea").bind("input propertychange", function(t, e) {
                    h(this),
                        a.elem.html("").append('<option selected="selected" value="' + this.value + '"></option>'),
                        a.elem.trigger("change", [e, this.value])
                  }).val(this.options.value),
                  setTimeout(function() {
                    a.textarea.trigger("propertychange")
                  }, 1);
              var i, r, s, o, n = this.elem.find("optgroup").remove();
              return this.menu = l((i = n,
                  r = this._checkAndSetDefault,
                  s = this,
                  o = '<div style="max-width: 100%;width: 400px;max-height: 500px;"><ul class="dropdown-menu combox-option" style="display: block;float: none;position: relative;border: 0;box-shadow: none;" class1="list-unstyled">',
                  i.each(function(t, e) {
                    var n = i.eq(t);
                    o += c(n.attr("label")),
                        n.find("option").each(function() {
                          o += u(this.value, this.innerText),
                              r.apply(s, [this.value, this.innerText])
                        })
                  }),
                  o += "</ul></div>")).delegate("a", "click", function(t) {
                var e = l(this)
                    , n = e.text()
                    , i = n.length;
                if (!a.options.replace) {
                  var r = a.textarea.focus().prop("selectionStart")
                      , s = a.textarea.prop("selectionEnd")
                      , o = a.textarea.val();
                  n = o.substring(0, r) + n + o.substring(s),
                      i += r
                }
                a.textarea.val(n).trigger("propertychange", e.attr("data-val")),
                    a.btn.tooltipster("hide"),
                    function(t, e) {
                      if (t.setSelectionRange)
                        t.setSelectionRange(e, e);
                      else if (t.createTextRange) {
                        var n = t.createTextRange();
                        n.collapse(!0),
                            n.moveEnd("character", e),
                            n.moveStart("character", e),
                            n.select()
                      }
                    }(a.textarea[0], i)
              }),
                  this.btn = l(this.options.optBtn).hide().tooltipster({
                    theme: "tooltipster-shadow",
                    interactive: !0,
                    contentCloning: !1,
                    trigger: "click",
                    side: ["right", "top", "bottom", "left"],
                    delay: 0,
                    distance: 0,
                    content: this.menu,
                    trackOrigin: !0
                  }),
              0 < n.find("option").length && (n = null,
                  this.btn.show()),
              this.options.disabled && this.disable(!0),
                  this
            },
            disable: function(t) {
              return t ? (this.textarea.attr("disabled", "disabled"),
                  this.btn.tooltipster("disable")) : (this.textarea.removeAttr("disabled"),
                  this.btn.tooltipster("enable")),
                  this
            },
            value: function(t, e) {
              if (null == t && null == e)
                return this.textarea.val();
              if (null == t) {
                for (var n = 0, i = this.items; n < i.length; n++)
                  if (i[n].id == e) {
                    var r = this
                        , s = i[n].id
                        , o = i[n].text;
                    setTimeout(function() {
                      r.textarea.val(o).trigger("propertychange", s)
                    }, 1);
                    break
                  }
              } else
                this.textarea.val(t),
                    this.options.value = t;
              return h(this.textarea[0]),
                  this
            },
            addGroup: function(t, e) {
              for (var n = c(t), i = 0; i < e.length; i++)
                n += u(e[i].id, e[i].text);
              this.menu.find("ul.combox-option").prepend(n),
                  this.btn.show()
            },
            _loadRemote: function(t) {
              if (this.options.category || (this.options.category = this.elem.attr("data-category"))) {
                var e = this.options.origin + this.options.sourceUrl + "?category=" + this.options.category;
                return l.ajax({
                  dataType: "json",
                  url: e,
                  xhrFields: {
                    withCredentials: !0
                  },
                  success: t
                }),
                    this
              }
            },
            _checkAndSetDefault: function(t, e) {
              if (this.items.push({
                id: t,
                text: e
              }),
              null === this.options.value && this.options.defaultId == t) {
                var n = this;
                setTimeout(function() {
                  n.textarea.val(e).trigger("propertychange", t)
                }, 1)
              }
            }
          },
          l.fn[o] = function(i) {
            var r = arguments
                , s = "!@~》#$%^";
            return this.map(function() {
              var t = "plugin_" + o;
              l.data(this, t) || l.data(this, t, new a(this,i));
              var e = l(this).data(t);
              if (e[i]) {
                var n = e[i].apply(e, Array.prototype.slice.call(r, 1));
                n !== e && (s = n)
              }
            }),
                "!@~》#$%^" == s ? this : s
          }
    }(jQuery);
var mIM = function(t, e, r, o) {
  if (!r) {
    if (!e)
      return;
    r = []
  }
  var s = e;
  if (e) {
    var n = {
      app: "sso",
      action: function(t) {
        return "/Account/Settings?group=" + t.id
      }
    };
    "string" == typeof e ? n.user = e : (n = $.extend(n, e),
        s = n.user),
        r.unshift(n)
  }
  var a = this
      , l = "im_enable_" + s;
  this.enable = !0,
      this.toggleEnable = function(t, e) {}
  ;
  var u, c = {}, h = {
    zh_CN: {
      invitation: " 邀请您进行视频会话",
      accept: "接受",
      repeated: "请勿重复邀请,10秒后再重试",
      readAll: "全部清除"
    },
    en: {
      invitation: " invite you to video conversation",
      accept: "Accept",
      repeated: "Repeated invitation,try again after 10 seconds",
      readAll: "Clear all"
    }
  };
  h = h[t];
  var f, p = {}, d = [], i = 0, g = !1, m = !1, v = !1, y = {};
  function b() {
    Messenger().hideAll()
  }
  function _() {
    mLogin("account", x, !0, o)
  }
  !function() {
    for (var t = 0; t < r.length; t++) {
      var e = r[t];
      e.dest ? e.dest = "/topic" + e.dest : e.dest = "/topic/Users/" + e.user + "/Messages",
          c[e.dest] = e
    }
    setInterval(function() {
      if (!m)
        return g ? (i = 0,
            g = !1,
            void (v || (I("init", r),
                v = !0))) : void (2 == ++i && (g = m = !0,
            I("connect"),
            _()));
      I("connect")
    }, 1e3),
        $(window).bind("storage", function(t) {
          switch ((t = t.originalEvent).key) {
            case l:
              return void a.toggleEnable(Boolean(t.newValue), !0);
            case "im_connect_" + s:
              return void (g = !0);
            case "im_conf_" + s:
              return void I("init", r);
            case "im_reload_" + s:
              return void (v = !1)
          }
          if (t.newValue || "undefined" == t.newValue)
            switch (t.key) {
              case "im_init_" + s:
                if (m && v && u && u.connected)
                  A(JSON.parse(t.newValue));
                return;
              case "im_del_page":
                return void E((e = t.newValue.split("_"))[0], e[1], !1, !0);
              case "im_del_" + s:
                var e;
                return void E((e = t.newValue.split("_"))[0], e[1], !0);
              case "im_add_" + s:
                if (m)
                  return;
                var n = JSON.parse(t.newValue)
                    , i = c[n.dest];
                i && "sso" != i.app ? i.callback(n.msg) : S(n.msg);
                break;
              case "im_groups_" + s:
                if (v)
                  return;
                return void C(JSON.parse(t.newValue))
            }
        }).bind("im_del", function(t, e, n) {
          v && E(e, n, !1, !0)
        });
    var n = $('<li class="messenger-message-slot im-header">            <div class="messenger-message"><a class="clear">' + h.readAll + "</a>           </div></li>");
    Messenger({
      header: n,
      maxMessages: 99
    }),
        n.find("a").bind("click", b)
  }();
  var w = 0;
  function x() {
    try {
      if (0 == this.contentWindow.location.pathname.indexOf("/SSO"))
        return void console.error("IM not login!")
    } catch (t) {}
    if (!1 in window)
      console.error("Nonsupport WebSocket!");
    else if (150 < w++)
      console.error("WebSocket connect failed!");
    else {
      var t = (o || "").split("//")
          , e = "";
      "http:" == t[0] ? e += "ws://" + t[1] : "https:" == t[0] ? e += "wss://" + t[1] : e += ("https:" == location.protocol ? "wss:" : "ws:") + "//" + location.host,
          (u = Stomp.client(e + "/Account/Broadcast")).ws.onclose = n,
          u.ws.onerror = n,
          u.connect({}, function(t) {
            A(r, !(w = 0)),
                I("conf"),
                v = !0
          }, n)
    }
    function n(t) {
      g = !1,
          u.ws.onclose = null,
          u.ws.onerror = null,
          setTimeout(_, 1e3 + 1e4 * Math.atan(w / 4))
    }
  }
  function A(t, e) {
    clearTimeout(f);
    for (var n = 0; n < t.length; n++) {
      var i = t[n]
          , r = c[i.dest];
      if (r) {
        if (r.load)
          continue
      } else
        r = c[i.dest] = i;
      r.load = !0,
      e || (v = !1),
          u.subscribe(i.dest, function(t) {
            var e = JSON.parse(t.body)
                , n = t.headers.destination
                , i = c[n];
            if (i && "sso" != i.app)
              return I("add", {
                dest: n,
                msg: e
              }),
                  void (i.callback && i.callback(e));
            if ($.isArray(e)) {
              if (0 == e.length && 0 < d.length)
                return;
              C(e)
            } else
              S(e),
                  I("add", {
                    dest: n,
                    msg: e
                  })
          })
    }
    f = setTimeout(function() {
      v ? I("groups", d) : e || I("reload")
    }, 100)
  }
  function C(t) {
    p = {},
        d.length = 0;
    for (var e = t.length - 1; 0 <= e; e--)
      S(t[e]);
    I("groups", d),
        v = !0
  }
  function S(t) {
    var e, n = t.id, i = p[n];
    if (i)
      (e = i.data).msgs = t.msgs.concat(e.msgs);
    else {
      if (y[t.id] == t.userId)
        return void I("del", n);
      i = p[n] = {
        data: t
      },
          e = t,
          d.unshift(e)
    }
    a.enable && (i.ui = k(e, n))
  }
  function k(e, t) {
    return t || (t = e.id),
        Messenger().post({
          id: t,
          message: function(t) {
            var e = "<div class='im-title'><a ";
            t.linkUrl && (e += "href='" + t.linkUrl + "'",
                e += " target='_blank' ");
            e += ">" + t.title + "</a></div>",
                e += '<ul class="im-msg">';
            for (var n = 0; n < t.msgs.length; n++) {
              var i = t.msgs[n];
              e += "<li>" + i.userName + " <span class='time'>" + (r = i.sendTime,
                  s = void 0,
                  [(s = new Date(r)).getMonth() + 1, "-", s.getDate(), " ", s.getHours(), ":", s.getMinutes(), ":", s.getSeconds()].join("")) + "</span><div class='im-content'>" + T(i.content) + "</div></li>"
            }
            var r, s;
            return e += "</ul>"
          }(e),
          showCloseButton: !0,
          events: {
            "click button.messenger-close": function(t) {
              E(e.id, e.userId)
            },
            "click .im-title>a": function(t) {
              t.target.href && E(e.id, e.userId, !1, !0)
            }
          },
          hideAfter: 0
        })
  }
  function T(t) {
    return -1 < t.indexOf("<div m-msg-file>") ? $(t).text() : t
  }
  function E(t, e, n, i) {
    var r = t
        , s = p[r];
    if (s) {
      delete p[r],
      s.ui && s.ui.hide();
      for (var o = 0; o < d.length; o++)
        if (d[o].id == t && d[o].userId == e) {
          d[o];
          return d.splice(o, 1),
              void (n || I("del", r))
        }
    }
  }
  function I(t, e) {
    t = "im_" + t + "_" + s,
        e ? "object" == typeof e && (e = JSON.stringify(e)) : e = "",
        localStorage.setItem(t, e),
        localStorage.removeItem(t)
  }
  this.videoWith = function(t, e, n) {
    n += "",
        t = (t += "").toLocaleLowerCase();
    var i = (new Date).getTime()
        , r = "im_" + t;
    if (i - parseInt(localStorage.getItem(r)) < 1e4)
      alert(h.repeated);
    else {
      localStorage.setItem(r, i);
      var s = "Connections/" + t + "?data=" + e;
      n && (s += "&inviter=" + n),
          mIM_showVideo(s, o)
    }
  }
}
    , IM_VIDEO_SERVICE = location.protocol + "//" + location.host;
function mIM_showVideo(t, e) {
  var n = window.screen
      , i = (n.height - 400) / 2
      , r = (n.width - 400) / 2;
  window.open((e || IM_VIDEO_SERVICE) + "/Account/IM/Video/" + t, "", "toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=yes,alwaysRaised=yes,z-lock=yes,top=" + i + ",left=" + r + ",width=400,height=400")
}
function mLogin(t, e, n, i) {
  var r = {
    account: "/Account/Login?v="
  }
      , s = document.getElementById("login_iframe_" + t);
  if (s) {
    if (s.callbacks.push(e),
        !n)
      return void (s.login && o(s.callbacks))
  } else
    (s = $("<iframe style='display: none'></iframe>").attr("id", "login_iframe_" + t).bind("load", function() {
      -1 < this.src.indexOf(r[t]) && (s.login = !0,
          o(s.callbacks))
    }).appendTo("body")[0]).callbacks = [e];
  function o(t) {
    for (var e = 0; e < t.length; e++)
      t[e] && t[e]();
    t.length = 0
  }
  s.src = (i || "") + r[t] + ((new Date).getTime() / 1e3).toFixed()
}
function mAppSig(t, e, n, i) {
  return md5([t, i, e, n].join("/n"))
}
function initAppSig(r) {
  var s = $.extend({}, r);
  if (delete s.token,
      delete s.url,
      s.addits)
    for (var t in delete s.addits,
        s.addit = [],
        r.addits)
      s[t] = r.addits[t],
          s.addit.push(t);
  return function(t, e) {
    s.random = (1e6 * Math.random()).toFixed(0);
    var n = e.indexOf("?")
        , i = -1 == n ? e : e.substring(0, n);
    return s.sig = mAppSig(r.token, t, i, s.random),
        i += -1 < n ? e.substring(n) + "&" : "?",
        i = (r.url || "") + i + $.param(s, !0)
  }
}
function mAppSigInterceptors(e, t) {
  var n = initAppSig(t);
  return {
    request: function(t) {
      return 0 === t.url.indexOf(e) && 0 !== t.url.indexOf("http") && (t.url = n(t.method, t.url)),
          t
    }
  }
}
function sortLocaleCompare(t, e) {
  return "string" == typeof t && "string" == typeof e ? t.localeCompare(e, "zh-Hans") : "number" == typeof t && "string" == typeof e ? -1 : "string" == typeof t && "number" == typeof e ? 1 : "number" == typeof t && "number" == typeof e ? e < t ? 1 : t < e ? -1 : 0 : void 0
}
!function(t) {
  "use strict";
  function h(t, e) {
    var n = (65535 & t) + (65535 & e);
    return (t >> 16) + (e >> 16) + (n >> 16) << 16 | 65535 & n
  }
  function a(t, e, n, i, r, s) {
    return h((o = h(h(e, t), h(i, s))) << (a = r) | o >>> 32 - a, n);
    var o, a
  }
  function f(t, e, n, i, r, s, o) {
    return a(e & n | ~e & i, t, e, r, s, o)
  }
  function p(t, e, n, i, r, s, o) {
    return a(e & i | n & ~i, t, e, r, s, o)
  }
  function d(t, e, n, i, r, s, o) {
    return a(e ^ n ^ i, t, e, r, s, o)
  }
  function g(t, e, n, i, r, s, o) {
    return a(n ^ (e | ~i), t, e, r, s, o)
  }
  function l(t, e) {
    t[e >> 5] |= 128 << e % 32,
        t[14 + (e + 64 >>> 9 << 4)] = e;
    var n, i, r, s, o, a = 1732584193, l = -271733879, u = -1732584194, c = 271733878;
    for (n = 0; n < t.length; n += 16)
      l = g(l = g(l = g(l = g(l = d(l = d(l = d(l = d(l = p(l = p(l = p(l = p(l = f(l = f(l = f(l = f(r = l, u = f(s = u, c = f(o = c, a = f(i = a, l, u, c, t[n], 7, -680876936), l, u, t[n + 1], 12, -389564586), a, l, t[n + 2], 17, 606105819), c, a, t[n + 3], 22, -1044525330), u = f(u, c = f(c, a = f(a, l, u, c, t[n + 4], 7, -176418897), l, u, t[n + 5], 12, 1200080426), a, l, t[n + 6], 17, -1473231341), c, a, t[n + 7], 22, -45705983), u = f(u, c = f(c, a = f(a, l, u, c, t[n + 8], 7, 1770035416), l, u, t[n + 9], 12, -1958414417), a, l, t[n + 10], 17, -42063), c, a, t[n + 11], 22, -1990404162), u = f(u, c = f(c, a = f(a, l, u, c, t[n + 12], 7, 1804603682), l, u, t[n + 13], 12, -40341101), a, l, t[n + 14], 17, -1502002290), c, a, t[n + 15], 22, 1236535329), u = p(u, c = p(c, a = p(a, l, u, c, t[n + 1], 5, -165796510), l, u, t[n + 6], 9, -1069501632), a, l, t[n + 11], 14, 643717713), c, a, t[n], 20, -373897302), u = p(u, c = p(c, a = p(a, l, u, c, t[n + 5], 5, -701558691), l, u, t[n + 10], 9, 38016083), a, l, t[n + 15], 14, -660478335), c, a, t[n + 4], 20, -405537848), u = p(u, c = p(c, a = p(a, l, u, c, t[n + 9], 5, 568446438), l, u, t[n + 14], 9, -1019803690), a, l, t[n + 3], 14, -187363961), c, a, t[n + 8], 20, 1163531501), u = p(u, c = p(c, a = p(a, l, u, c, t[n + 13], 5, -1444681467), l, u, t[n + 2], 9, -51403784), a, l, t[n + 7], 14, 1735328473), c, a, t[n + 12], 20, -1926607734), u = d(u, c = d(c, a = d(a, l, u, c, t[n + 5], 4, -378558), l, u, t[n + 8], 11, -2022574463), a, l, t[n + 11], 16, 1839030562), c, a, t[n + 14], 23, -35309556), u = d(u, c = d(c, a = d(a, l, u, c, t[n + 1], 4, -1530992060), l, u, t[n + 4], 11, 1272893353), a, l, t[n + 7], 16, -155497632), c, a, t[n + 10], 23, -1094730640), u = d(u, c = d(c, a = d(a, l, u, c, t[n + 13], 4, 681279174), l, u, t[n], 11, -358537222), a, l, t[n + 3], 16, -722521979), c, a, t[n + 6], 23, 76029189), u = d(u, c = d(c, a = d(a, l, u, c, t[n + 9], 4, -640364487), l, u, t[n + 12], 11, -421815835), a, l, t[n + 15], 16, 530742520), c, a, t[n + 2], 23, -995338651), u = g(u, c = g(c, a = g(a, l, u, c, t[n], 6, -198630844), l, u, t[n + 7], 10, 1126891415), a, l, t[n + 14], 15, -1416354905), c, a, t[n + 5], 21, -57434055), u = g(u, c = g(c, a = g(a, l, u, c, t[n + 12], 6, 1700485571), l, u, t[n + 3], 10, -1894986606), a, l, t[n + 10], 15, -1051523), c, a, t[n + 1], 21, -2054922799), u = g(u, c = g(c, a = g(a, l, u, c, t[n + 8], 6, 1873313359), l, u, t[n + 15], 10, -30611744), a, l, t[n + 6], 15, -1560198380), c, a, t[n + 13], 21, 1309151649), u = g(u, c = g(c, a = g(a, l, u, c, t[n + 4], 6, -145523070), l, u, t[n + 11], 10, -1120210379), a, l, t[n + 2], 15, 718787259), c, a, t[n + 9], 21, -343485551),
          a = h(a, i),
          l = h(l, r),
          u = h(u, s),
          c = h(c, o);
    return [a, l, u, c]
  }
  function u(t) {
    var e, n = "", i = 32 * t.length;
    for (e = 0; e < i; e += 8)
      n += String.fromCharCode(t[e >> 5] >>> e % 32 & 255);
    return n
  }
  function c(t) {
    var e, n = [];
    for (n[(t.length >> 2) - 1] = void 0,
             e = 0; e < n.length; e += 1)
      n[e] = 0;
    var i = 8 * t.length;
    for (e = 0; e < i; e += 8)
      n[e >> 5] |= (255 & t.charCodeAt(e / 8)) << e % 32;
    return n
  }
  function i(t) {
    var e, n, i = "0123456789abcdef", r = "";
    for (n = 0; n < t.length; n += 1)
      e = t.charCodeAt(n),
          r += i.charAt(e >>> 4 & 15) + i.charAt(15 & e);
    return r
  }
  function n(t) {
    return unescape(encodeURIComponent(t))
  }
  function r(t) {
    return u(l(c(e = n(t)), 8 * e.length));
    var e
  }
  function s(t, e) {
    return function(t, e) {
      var n, i, r = c(t), s = [], o = [];
      for (s[15] = o[15] = void 0,
           16 < r.length && (r = l(r, 8 * t.length)),
               n = 0; n < 16; n += 1)
        s[n] = 909522486 ^ r[n],
            o[n] = 1549556828 ^ r[n];
      return i = l(s.concat(c(e)), 512 + 8 * e.length),
          u(l(o.concat(i), 640))
    }(n(t), n(e))
  }
  function e(t, e, n) {
    return e ? n ? s(e, t) : i(s(e, t)) : n ? r(t) : i(r(t))
  }
  "function" == typeof define && define.amd ? define("md5", function() {
    return window.md5 = e
  }) : "object" == typeof module && module.exports ? module.exports = e : t.md5 = e
}(this),
    function() {
      var t, e = window.Messenger;
      t = window.Messenger = function() {
        return t._call.apply(this, arguments)
      }
          ,
          window.Messenger.noConflict = function() {
            return window.Messenger = e,
                t
          }
    }(),
    window.Messenger._ = function() {
      if (window._)
        return window._;
      var t = Array.prototype
          , e = Object.prototype
          , n = Function.prototype
          , i = (t.push,
              t.slice)
          , r = (t.concat,
              e.toString)
          , o = (e.hasOwnProperty,
              t.forEach)
          , a = (t.map,
              t.reduce,
              t.reduceRight,
              t.filter)
          , s = (t.every,
              t.some,
              t.indexOf,
              t.lastIndexOf,
              Array.isArray,
              Object.keys)
          , l = n.bind
          , u = {}
          , c = {}
          , h = u.each = u.forEach = function(t, e, n) {
            if (null != t)
              if (o && t.forEach === o)
                t.forEach(e, n);
              else if (t.length === +t.length) {
                for (var i = 0, r = t.length; i < r; i++)
                  if (e.call(n, t[i], i, t) === c)
                    return
              } else
                for (var s in t)
                  if (u.has(t, s) && e.call(n, t[s], s, t) === c)
                    return
          }
      ;
      u.result = function(t, e) {
        if (null == t)
          return null;
        var n = t[e];
        return u.isFunction(n) ? n.call(t) : n
      }
          ,
          u.once = function(t) {
            var e, n = !1;
            return function() {
              return n || (n = !0,
                  e = t.apply(this, arguments),
                  t = null),
                  e
            }
          }
      ;
      var f = 0;
      return u.uniqueId = function(t) {
        var e = ++f + "";
        return t ? t + e : e
      }
          ,
          u.filter = u.select = function(t, i, r) {
            var s = [];
            return null == t ? s : a && t.filter === a ? t.filter(i, r) : (h(t, function(t, e, n) {
              i.call(r, t, e, n) && (s[s.length] = t)
            }),
                s)
          }
          ,
          h(["Arguments", "Function", "String", "Number", "Date", "RegExp"], function(e) {
            u["is" + e] = function(t) {
              return r.call(t) == "[object " + e + "]"
            }
          }),
          u.defaults = function(n) {
            return h(i.call(arguments, 1), function(t) {
              if (t)
                for (var e in t)
                  null == n[e] && (n[e] = t[e])
            }),
                n
          }
          ,
          u.extend = function(n) {
            return h(i.call(arguments, 1), function(t) {
              if (t)
                for (var e in t)
                  n[e] = t[e]
            }),
                n
          }
          ,
          u.keys = s || function(t) {
            if (t !== Object(t))
              throw new TypeError("Invalid object");
            var e = [];
            for (var n in t)
              u.has(t, n) && (e[e.length] = n);
            return e
          }
          ,
          u.bind = function(t, e) {
            if (t.bind === l && l)
              return l.apply(t, i.call(arguments, 1));
            var n = i.call(arguments, 2);
            return function() {
              return t.apply(e, n.concat(i.call(arguments)))
            }
          }
          ,
          u.isObject = function(t) {
            return t === Object(t)
          }
          ,
          u
    }(),
    window.Messenger.Events = function() {
      if (window.Backbone && Backbone.Events)
        return Backbone.Events;
      var l, h, r, t;
      return l = /\s+/,
          h = function(t, e, n, i) {
            if (!n)
              return !0;
            if ("object" == typeof n)
              for (var r in n)
                t[e].apply(t, [r, n[r]].concat(i));
            else {
              if (!l.test(n))
                return !0;
              for (var s = n.split(l), o = 0, a = s.length; o < a; o++)
                t[e].apply(t, [s[o]].concat(i))
            }
          }
          ,
          r = function(t, e) {
            var n, i = -1, r = t.length;
            switch (e.length) {
              case 0:
                for (; ++i < r; )
                  (n = t[i]).callback.call(n.ctx);
                return;
              case 1:
                for (; ++i < r; )
                  (n = t[i]).callback.call(n.ctx, e[0]);
                return;
              case 2:
                for (; ++i < r; )
                  (n = t[i]).callback.call(n.ctx, e[0], e[1]);
                return;
              case 3:
                for (; ++i < r; )
                  (n = t[i]).callback.call(n.ctx, e[0], e[1], e[2]);
                return;
              default:
                for (; ++i < r; )
                  (n = t[i]).callback.apply(n.ctx, e)
            }
          }
          ,
          (t = {
            on: function(t, e, n) {
              return h(this, "on", t, [e, n]) && e && (this._events || (this._events = {}),
                  (this._events[t] || (this._events[t] = [])).push({
                    callback: e,
                    context: n,
                    ctx: n || this
                  })),
                  this
            },
            once: function(t, e, n) {
              if (!h(this, "once", t, [e, n]) || !e)
                return this;
              var i = this
                  , r = _.once(function() {
                i.off(t, r),
                    e.apply(this, arguments)
              });
              return r._callback = e,
                  this.on(t, r, n),
                  this
            },
            off: function(t, e, n) {
              var i, r, s, o, a, l, u, c;
              if (!this._events || !h(this, "off", t, [e, n]))
                return this;
              if (!t && !e && !n)
                return this._events = {},
                    this;
              for (a = 0,
                       l = (o = t ? [t] : _.keys(this._events)).length; a < l; a++)
                if (t = o[a],
                    i = this._events[t]) {
                  if (s = [],
                  e || n)
                    for (u = 0,
                             c = i.length; u < c; u++)
                      r = i[u],
                      (e && e !== r.callback && e !== r.callback._callback || n && n !== r.context) && s.push(r);
                  this._events[t] = s
                }
              return this
            },
            trigger: function(t) {
              if (!this._events)
                return this;
              var e = Array.prototype.slice.call(arguments, 1);
              if (!h(this, "trigger", t, e))
                return this;
              var n = this._events[t]
                  , i = this._events.all;
              return n && r(n, e),
              i && r(i, arguments),
                  this
            },
            listenTo: function(t, e, n) {
              return ((this._listeners || (this._listeners = {}))[t._listenerId || (t._listenerId = _.uniqueId("l"))] = t).on(e, "object" == typeof e ? this : n, this),
                  this
            },
            stopListening: function(t, e, n) {
              var i = this._listeners;
              if (i) {
                if (t)
                  t.off(e, "object" == typeof e ? this : n, this),
                  e || n || delete i[t._listenerId];
                else {
                  for (var r in "object" == typeof e && (n = this),
                      i)
                    i[r].off(e, n, this);
                  this._listeners = {}
                }
                return this
              }
            }
          }).bind = t.on,
          t.unbind = t.off,
          t
    }(),
    function() {
      var w, l, n, e, o, x, a, u, t, i, r, s = {}.hasOwnProperty, c = function(t, e) {
            for (var n in e)
              s.call(e, n) && (t[n] = e[n]);
            function i() {
              this.constructor = t
            }
            return i.prototype = e.prototype,
                t.prototype = new i,
                t.__super__ = e.prototype,
                t
          }, A = [].slice, C = [].indexOf || function(t) {
            for (var e = 0, n = this.length; e < n; e++)
              if (e in this && this[e] === t)
                return e;
            return -1
          }
      ;
      w = jQuery,
          x = null != (t = window._) ? t : window.Messenger._,
          e = null != (i = "undefined" != typeof Backbone && null !== Backbone ? Backbone.Events : void 0) ? i : window.Messenger.Events,
          n = function() {
            function t(t) {
              w.extend(this, e),
              x.isObject(t) && (t.el && this.setElement(t.el),
                  this.model = t.model),
                  this.initialize.apply(this, arguments)
            }
            return t.prototype.setElement = function(t) {
              return this.$el = w(t),
                  this.el = this.$el[0]
            }
                ,
                t.prototype.delegateEvents = function(t) {
                  var e, n, i, r, s, o, a;
                  if (t || (t = x.result(this, "events"))) {
                    for (i in this.undelegateEvents(),
                        e = /^(\S+)\s*(.*)$/,
                        a = [],
                        t) {
                      if (s = t[i],
                      x.isFunction(s) || (s = this[t[i]]),
                          !s)
                        throw new Error('Method "' + t[i] + '" does not exist');
                      n = (r = i.match(e))[1],
                          o = r[2],
                          s = x.bind(s, this),
                          n += ".delegateEvents" + this.cid,
                          "" === o ? a.push(this.jqon(n, s)) : a.push(this.jqon(n, o, s))
                    }
                    return a
                  }
                }
                ,
                t.prototype.jqon = function(t, e, n) {
                  var i;
                  return null != this.$el.on ? (i = this.$el).on.apply(i, arguments) : (null == n && (n = e,
                      e = void 0),
                      null != e ? this.$el.delegate(e, t, n) : this.$el.bind(t, n))
                }
                ,
                t.prototype.jqoff = function(t) {
                  var e;
                  return null != this.$el.off ? (e = this.$el).off.apply(e, arguments) : (this.$el.undelegate(),
                      this.$el.unbind(t))
                }
                ,
                t.prototype.undelegateEvents = function() {
                  return this.jqoff(".delegateEvents" + this.cid)
                }
                ,
                t.prototype.remove = function() {
                  return this.undelegateEvents(),
                      this.$el.remove()
                }
                ,
                t
          }(),
          a = function(t) {
            function e() {
              return e.__super__.constructor.apply(this, arguments)
            }
            return c(e, n),
                e.prototype.defaults = {
                  hideAfter: 10,
                  scroll: !0,
                  closeButtonText: "&times;"
                },
                e.prototype.initialize = function(t) {
                  return null == t && (t = {}),
                      this.shown = !1,
                      this.rendered = !1,
                      this.messenger = t.messenger,
                      this.options = w.extend({}, this.options, t, this.defaults)
                }
                ,
                e.prototype.show = function() {
                  var t;
                  if (this.rendered || this.render(),
                      this.$message.removeClass("messenger-hidden"),
                      t = this.shown,
                      this.shown = !0,
                      !t)
                    return this.trigger("show")
                }
                ,
                e.prototype.hide = function() {
                  var t;
                  if (this.rendered)
                    return this.$message.addClass("messenger-hidden"),
                        t = this.shown,
                        this.shown = !1,
                        t ? this.trigger("hide") : void 0
                }
                ,
                e.prototype.cancel = function() {
                  return this.hide()
                }
                ,
                e.prototype.update = function(t) {
                  var e, n = this;
                  return x.isString(t) && (t = {
                    message: t
                  }),
                      w.extend(this.options, t),
                      this.lastUpdate = new Date,
                      this.rendered = !1,
                      this.events = null != (e = this.options.events) ? e : {},
                      this.render(),
                      this.actionsToEvents(),
                      this.delegateEvents(),
                      this.checkClickable(),
                      this.options.hideAfter ? (this.$message.addClass("messenger-will-hide-after"),
                      null != this._hideTimeout && clearTimeout(this._hideTimeout),
                          this._hideTimeout = setTimeout(function() {
                            return n.hide()
                          }, 1e3 * this.options.hideAfter)) : this.$message.removeClass("messenger-will-hide-after"),
                      this.options.hideOnNavigate ? (this.$message.addClass("messenger-will-hide-on-navigate"),
                      null != ("undefined" != typeof Backbone && null !== Backbone ? Backbone.history : void 0) && Backbone.history.on("route", function() {
                        return n.hide()
                      })) : this.$message.removeClass("messenger-will-hide-on-navigate"),
                      this.trigger("update", this)
                }
                ,
                e.prototype.scrollTo = function() {
                  if (this.options.scroll)
                    return w.scrollTo(this.$el, {
                      duration: 400,
                      offset: {
                        left: 0,
                        top: -20
                      }
                    })
                }
                ,
                e.prototype.timeSinceUpdate = function() {
                  return this.lastUpdate ? new Date - this.lastUpdate : null
                }
                ,
                e.prototype.actionsToEvents = function() {
                  var t, n, e, i, r = this;
                  for (n in i = [],
                      e = this.options.actions)
                    t = e[n],
                        i.push(this.events['click [data-action="' + n + '"] a'] = function(e) {
                          return function(t) {
                            return t.preventDefault(),
                                t.stopPropagation(),
                                r.trigger("action:" + n, e, t),
                                e.action.call(r, t, r)
                          }
                        }(t));
                  return i
                }
                ,
                e.prototype.checkClickable = function() {
                  var t, e, n;
                  for (t in n = [],
                      e = this.events)
                    e[t],
                        "click" === t ? n.push(this.$message.addClass("messenger-clickable")) : n.push(void 0);
                  return n
                }
                ,
                e.prototype.undelegateEvents = function() {
                  var t;
                  return e.__super__.undelegateEvents.apply(this, arguments),
                      null != (t = this.$message) ? t.removeClass("messenger-clickable") : void 0
                }
                ,
                e.prototype.parseActions = function() {
                  var t, e, n, i, r;
                  for (i in e = [],
                      r = this.options.actions)
                    t = r[i],
                        (n = w.extend({}, t)).name = i,
                    null == n.label && (n.label = i),
                        e.push(n);
                  return e
                }
                ,
                e.prototype.template = function(t) {
                  var e, n, i, r, s, o, a, l, u, c, h = this;
                  for (s = w("<div class='messenger-message message alert " + t.type + "-rename message-" + t.type + " alert-" + t.type + "'>"),
                       t.showCloseButton && ((i = w('<button type="button" class="messenger-close" data-dismiss="alert">')).html(t.closeButtonText),
                           i.click(function() {
                             return h.cancel(),
                                 !0
                           }),
                           s.append(i)),
                           o = w('<div class="messenger-message-inner">' + t.message + "</div>"),
                           s.append(o),
                       t.actions.length && (n = w('<div class="messenger-actions">')),
                           l = 0,
                           u = (c = t.actions).length; l < u; l++)
                    a = c[l],
                        (e = w("<span>")).attr("data-action", "" + a.name),
                        (r = w("<a>")).html(a.label),
                        e.append(w('<span class="messenger-phrase">')),
                        e.append(r),
                        n.append(e);
                  return s.append(n),
                      s
                }
                ,
                e.prototype.render = function() {
                  var t;
                  if (!this.rendered)
                    return this._hasSlot || (this.setElement(this.messenger._reserveMessageSlot(this, t)),
                        this._hasSlot = !0),
                        t = w.extend({}, this.options, {
                          actions: this.parseActions()
                        }),
                        this.$message = w(this.template(t)),
                        this.$el.html(this.$message),
                        this.shown = !0,
                        this.rendered = !0,
                        this.trigger("render")
                }
                ,
                e
          }(),
          o = function(t) {
            function r() {
              return r.__super__.constructor.apply(this, arguments)
            }
            return c(r, a),
                r.prototype.initialize = function() {
                  return r.__super__.initialize.apply(this, arguments),
                      this._timers = {}
                }
                ,
                r.prototype.cancel = function() {
                  if (this.clearTimers(),
                      this.hide(),
                  null != this._actionInstance && null != this._actionInstance.abort)
                    return this._actionInstance.abort()
                }
                ,
                r.prototype.clearTimers = function() {
                  var t, e, n, i;
                  for (t in n = this._timers)
                    e = n[t],
                        clearTimeout(e);
                  return this._timers = {},
                      null != (i = this.$message) ? i.removeClass("messenger-retry-soon messenger-retry-later") : void 0
                }
                ,
                r.prototype.render = function() {
                  var t, e, n, i;
                  for (e in r.__super__.render.apply(this, arguments),
                      this.clearTimers(),
                      i = [],
                      n = this.options.actions)
                    (t = n[e]).auto ? i.push(this.startCountdown(e, t)) : i.push(void 0);
                  return i
                }
                ,
                r.prototype.renderPhrase = function(t, e) {
                  return t.phrase.replace("TIME", this.formatTime(e))
                }
                ,
                r.prototype.formatTime = function(t) {
                  var e;
                  return e = function(t, e) {
                    return 1 !== (t = Math.floor(t)) && (e += "s"),
                    "in " + t + " " + e
                  }
                      ,
                      0 === Math.floor(t) ? "now..." : t < 60 ? e(t, "second") : (t /= 60) < 60 ? e(t, "minute") : e(t /= 60, "hour")
                }
                ,
                r.prototype.startCountdown = function(e, n) {
                  var i, r, s, t, o = this;
                  if (null == this._timers[e])
                    return i = this.$message.find("[data-action='" + e + "'] .messenger-phrase"),
                        (r = null != (t = n.delay) ? t : 3) <= 10 ? (this.$message.removeClass("messenger-retry-later"),
                            this.$message.addClass("messenger-retry-soon")) : (this.$message.removeClass("messenger-retry-soon"),
                            this.$message.addClass("messenger-retry-later")),
                        (s = function() {
                              var t;
                              return i.text(o.renderPhrase(n, r)),
                                  0 < r ? (t = Math.min(r, 1),
                                      r -= t,
                                      o._timers[e] = setTimeout(s, 1e3 * t)) : (o.$message.removeClass("messenger-retry-soon messenger-retry-later"),
                                      delete o._timers[e],
                                      n.action())
                            }
                        )()
                }
                ,
                r
          }(),
          u = function(t) {
            function e() {
              return e.__super__.constructor.apply(this, arguments)
            }
            return c(e, n),
                e.prototype.tagName = "ul",
                e.prototype.className = "messenger",
                e.prototype.messageDefaults = {
                  type: "info"
                },
                e.prototype.initialize = function(t) {
                  return this.options = null != t ? t : {},
                      this.history = [],
                      this.messageDefaults = w.extend({}, this.messageDefaults, this.options.messageDefaults)
                }
                ,
                e.prototype.render = function() {
                  return this.updateMessageSlotClasses()
                }
                ,
                e.prototype.findById = function(e) {
                  return x.filter(this.history, function(t) {
                    return t.msg.options.id === e
                  })
                }
                ,
                e.prototype._reserveMessageSlot = function(t, e) {
                  var n, i, r = this;
                  for ((n = w("<li>")).addClass("messenger-message-slot"),
                           this.options.header ? this.$el.find("li:first").after(n) : this.$el.prepend(n),
                           this.history.push({
                             msg: t,
                             $slot: n
                           }),
                           this._enforceIdConstraint(t),
                           t.on("update", function() {
                             return r._enforceIdConstraint(t)
                           }); this.options.maxMessages && this.history.length > this.options.maxMessages; )
                    (i = this.history.shift()).msg.remove(),
                        i.$slot.remove();
                  return n
                }
                ,
                e.prototype._enforceIdConstraint = function(t) {
                  var e, n, i, r;
                  if (null != t.options.id)
                    for (e = 0,
                             n = (r = this.history).length; e < n; e++)
                      if (null != (i = r[e].msg).options.id && i.options.id === t.options.id && t !== i) {
                        if (t.options.singleton)
                          return void t.hide();
                        i.hide()
                      }
                }
                ,
                e.prototype.newMessage = function(t) {
                  var e, n, i, r, s = this;
                  return null == t && (t = {}),
                      t.messenger = this,
                      a = null != (n = null != (i = Messenger.themes[null != (r = t.theme) ? r : this.options.theme]) ? i.Message : void 0) ? n : o,
                      (e = new a(t)).on("show", function() {
                        if (t.scrollTo && "fixed" !== s.$el.css("position"))
                          return e.scrollTo()
                      }),
                      e.on("hide show render", this.updateMessageSlotClasses, this),
                      e
                }
                ,
                e.prototype.updateMessageSlotClasses = function() {
                  var t, e, n, i, r, s, o;
                  for (t = !(i = !(e = null)),
                           r = 0,
                           s = (o = this.history).length; r < s; r++)
                    (n = o[r]).$slot.removeClass("messenger-first messenger-last messenger-shown"),
                    n.msg.shown && n.msg.rendered && (n.$slot.addClass("messenger-shown"),
                        t = !0,
                        e = n,
                    i && (i = !1,
                        n.$slot.addClass("messenger-first")));
                  return null != e && e.$slot.addClass("messenger-last"),
                      this.$el[(t ? "remove" : "add") + "Class"]("messenger-empty")
                }
                ,
                e.prototype.hideAll = function() {
                  var t, e, n, i, r;
                  for (r = [],
                           e = 0,
                           n = (i = this.history).length; e < n; e++)
                    t = i[e],
                        r.push(t.msg.hide());
                  return r
                }
                ,
                e.prototype.post = function(t) {
                  var e;
                  return x.isString(t) && (t = {
                    message: t
                  }),
                      t = w.extend(!0, {}, this.messageDefaults, t),
                      (e = this.newMessage(t)).update(t),
                      e
                }
                ,
                e
          }(),
          l = function(t) {
            function e() {
              return e.__super__.constructor.apply(this, arguments)
            }
            return c(e, u),
                e.prototype.doDefaults = {
                  progressMessage: null,
                  successMessage: null,
                  errorMessage: "Error connecting to the server.",
                  showSuccessWithoutError: !0,
                  retry: {
                    auto: !0,
                    allow: !0
                  },
                  action: w.ajax
                },
                e.prototype.hookBackboneAjax = function(n) {
                  var i, r = this;
                  if (null == n && (n = {}),
                  null == window.Backbone)
                    throw "Expected Backbone to be defined";
                  return n = x.defaults(n, {
                    id: "BACKBONE_ACTION",
                    errorMessage: !1,
                    successMessage: "Request completed successfully.",
                    showSuccessWithoutError: !1
                  }),
                      i = function(t) {
                        var e;
                        return e = x.extend({}, n, t.messenger),
                            r.do(e, t)
                      }
                      ,
                      null != Backbone.ajax ? (Backbone.ajax._withoutMessenger && (Backbone.ajax = Backbone.ajax._withoutMessenger),
                      null != n.action && n.action !== this.doDefaults.action || (n.action = Backbone.ajax),
                          i._withoutMessenger = Backbone.ajax,
                          Backbone.ajax = i) : Backbone.sync = x.wrap(Backbone.sync, function() {
                        var t, e, n;
                        return n = arguments[0],
                            t = 2 <= arguments.length ? A.call(arguments, 1) : [],
                            e = w.ajax,
                            w.ajax = i,
                            n.call.apply(n, [this].concat(A.call(t))),
                            w.ajax = e
                      })
                }
                ,
                e.prototype._getHandlerResponse = function(t) {
                  return !1 !== t && (!0 === t || null == t || t)
                }
                ,
                e.prototype._parseEvents = function(t) {
                  var e, n, i, r, s, o;
                  for (r in null == t && (t = {}),
                      s = {},
                      t)
                    i = t[r],
                        n = r.indexOf(" "),
                        o = r.substring(0, n),
                        e = r.substring(n + 1),
                    null == s[o] && (s[o] = {}),
                        s[o][e] = i;
                  return s
                }
                ,
                e.prototype._normalizeResponse = function() {
                  var t, e, n, i, r, s, o;
                  for (t = r = i = null,
                           s = 0,
                           o = (n = 1 <= arguments.length ? A.call(arguments, 0) : []).length; s < o; s++)
                    "success" === (e = n[s]) || "timeout" === e || "abort" === e ? i = e : null != (null != e ? e.readyState : void 0) && null != (null != e ? e.responseText : void 0) ? r = e : x.isObject(e) && (t = e);
                  return [i, t, r]
                }
                ,
                e.prototype.do = e.prototype.run = function() {
                  var d, g, m, t, e, v, y, b, n, i, _ = this;
                  if (v = arguments[0],
                      b = arguments[1],
                      d = 3 <= arguments.length ? A.call(arguments, 2) : [],
                  null == b && (b = {}),
                      v = w.extend(!0, {}, this.messageDefaults, this.doDefaults, null != v ? v : {}),
                      g = this._parseEvents(v.events),
                      m = function(t, e) {
                        var n;
                        return n = v[t + "Message"],
                            x.isFunction(n) ? n.call(_, t, e) : n
                      }
                      ,
                      y = null != (i = v.messageInstance) ? i : this.newMessage(v),
                  null != v.id && (y.options.id = v.id),
                  null != v.progressMessage && y.update(w.extend({}, v, {
                    message: m("progress", null),
                    type: "info"
                  })),
                      e = {},
                      x.each(["error", "success"], function(f) {
                        var p;
                        return p = b[f],
                            e[f] = function() {
                              var t, e, n, i, r, s, o, a, l, u, c, h;
                              if (r = 1 <= arguments.length ? A.call(arguments, 0) : [],
                                  i = (a = _._normalizeResponse.apply(_, r))[0],
                                  a[1],
                                  o = a[2],
                              "success" === f && null == y.errorCount && !1 === v.showSuccessWithoutError && (v.successMessage = null),
                              "error" === f && (null == v.errorCount && (v.errorCount = 0),
                                  v.errorCount += 1),
                                  e = v.returnsPromise ? r[0] : "function" == typeof p ? p.apply(null, r) : void 0,
                                  s = _._getHandlerResponse(e),
                              x.isString(s) && (s = {
                                message: s
                              }),
                              "error" !== f || 0 !== (null != o ? o.status : void 0) && "abort" !== i) {
                                if (!("error" === f && null != v.ignoredErrorCodes && (l = null != o ? o.status : void 0,
                                0 <= C.call(v.ignoredErrorCodes, l))))
                                  return t = {
                                    message: m(f, o),
                                    type: f,
                                    events: null != (u = g[f]) ? u : {},
                                    hideOnNavigate: "success" === f
                                  },
                                  "number" == typeof (null != (c = (n = w.extend({}, v, t, s)).retry) ? c.allow : void 0) && n.retry.allow--,
                                      "error" === f && 500 <= (null != o ? o.status : void 0) && (null != (h = n.retry) ? h.allow : void 0) ? (null == n.retry.delay && (n.errorCount < 4 ? n.retry.delay = 10 : n.retry.delay = 300),
                                      n.hideAfter && (null == n._hideAfter && (n._hideAfter = n.hideAfter),
                                          n.hideAfter = n._hideAfter + n.retry.delay),
                                          n._retryActions = !0,
                                          n.actions = {
                                            retry: {
                                              label: "retry now",
                                              phrase: "Retrying TIME",
                                              auto: n.retry.auto,
                                              delay: n.retry.delay,
                                              action: function() {
                                                return n.messageInstance = y,
                                                    setTimeout(function() {
                                                      return _.do.apply(_, [n, b].concat(A.call(d)))
                                                    }, 0)
                                              }
                                            },
                                            cancel: {
                                              action: function() {
                                                return y.cancel()
                                              }
                                            }
                                          }) : n._retryActions && (delete n.actions.retry,
                                          delete n.actions.cancel,
                                          delete v._retryActions),
                                      y.update(n),
                                      s && n.message ? (Messenger(x.extend({}, _.options, {
                                        instance: _
                                      })),
                                          y.show()) : y.hide();
                                y.hide()
                              } else
                                y.hide()
                            }
                      }),
                      !v.returnsPromise)
                    for (n in e)
                      t = e[n],
                          b[n],
                          b[n] = t;
                  return y._actionInstance = v.action.apply(v, [b].concat(A.call(d))),
                  v.returnsPromise && y._actionInstance.then(e.success, e.error),
                      y
                }
                ,
                e.prototype.ajax = function() {
                  var t, e;
                  return e = arguments[0],
                      t = 2 <= arguments.length ? A.call(arguments, 1) : [],
                      e.action = w.ajax,
                      this.run.apply(this, [e].concat(A.call(t)))
                }
                ,
                e.prototype.expectPromise = function(t, e) {
                  return e = x.extend({}, e, {
                    action: t,
                    returnsPromise: !0
                  }),
                      this.run(e)
                }
                ,
                e.prototype.error = function(t) {
                  return null == t && (t = {}),
                  "string" == typeof t && (t = {
                    message: t
                  }),
                      t.type = "error",
                      this.post(t)
                }
                ,
                e.prototype.info = function(t) {
                  return null == t && (t = {}),
                  "string" == typeof t && (t = {
                    message: t
                  }),
                      t.type = "info",
                      this.post(t)
                }
                ,
                e.prototype.success = function(t) {
                  return null == t && (t = {}),
                  "string" == typeof t && (t = {
                    message: t
                  }),
                      t.type = "success",
                      this.post(t)
                }
                ,
                e
          }(),
          w.fn.messenger = function() {
            var t, e, n, i, r, s, o, a;
            return n = arguments[0],
                e = 2 <= arguments.length ? A.call(arguments, 1) : [],
            null == n && (n = {}),
                t = this,
                null != n && x.isString(n) ? (a = t.data("messenger"))[n].apply(a, e) : (r = n,
                null == t.data("messenger") && (u = null != (s = null != (o = Messenger.themes[r.theme]) ? o.Messenger : void 0) ? s : l,
                    t.data("messenger", i = new u(w.extend({
                      el: t
                    }, r))),
                    i.render()),
                    t.data("messenger"))
          }
          ,
          window.Messenger._call = function(t) {
            var e, n, i, r, s, o, a, l, u, c;
            if (s = {
              extraClasses: "messenger-fixed messenger-on-bottom messenger-on-right",
              theme: "future",
              maxMessages: 9,
              parentLocations: ["body"]
            },
            null != (t = w.extend(s, w._messengerDefaults, Messenger.options, t)).theme && (t.extraClasses += " messenger-theme-" + t.theme),
                o = t.instance || Messenger.instance,
            null == t.instance) {
              for (n = null,
                       u = 0,
                       c = (l = t.parentLocations).length; u < c; u++)
                if (a = l[u],
                    (n = w(a)).length) {
                  i = a;
                  break
                }
              o ? w(o._location).is(w(i)) || (o.$el.detach(),
                  n.prepend(o.$el)) : (e = w("<ul>"),
              t.header && e.append(t.header),
                  n.prepend(e),
                  (o = e.messenger(t))._location = i,
                  Messenger.instance = o)
            }
            return null != o._addedClasses && o.$el.removeClass(o._addedClasses),
                o.$el.addClass(r = o.className + " " + t.extraClasses),
                o._addedClasses = r,
                o
          }
          ,
          w.extend(Messenger, {
            Message: o,
            Messenger: l,
            themes: null != (r = Messenger.themes) ? r : {}
          }),
          w.globalMessenger = window.Messenger = Messenger
    }
        .call(this),
    function() {
      var i, t, r = {}.hasOwnProperty;
      i = jQuery,
          t = function(t) {
            function n() {
              return n.__super__.constructor.apply(this, arguments)
            }
            return function(t, e) {
              for (var n in e)
                r.call(e, n) && (t[n] = e[n]);
              function i() {
                this.constructor = t
              }
              i.prototype = e.prototype,
                  t.prototype = new i,
                  t.__super__ = e.prototype
            }(n, window.Messenger.Message),
                n.prototype.template = function(t) {
                  var e;
                  return (e = n.__super__.template.apply(this, arguments)).append(i('<div class="messenger-spinner">\n    <span class="messenger-spinner-side messenger-spinner-side-left">\n        <span class="messenger-spinner-fill"></span>\n    </span>\n    <span class="messenger-spinner-side messenger-spinner-side-right">\n        <span class="messenger-spinner-fill"></span>\n    </span>\n</div>')),
                      e
                }
                ,
                n
          }(),
          window.Messenger.themes.flat = {
            Message: t
          }
    }
        .call(this),
    Messenger.options = {
      extraClasses: "messenger-fixed messenger-on-top messenger-on-right",
      theme: "flat",
      messageDefaults: {
        showCloseButton: !0,
        hideAfter: 5
      }
    },
    function(v) {
      "use strict";
      var s = {
        tagClass: function(t) {
          return "label label-info"
        },
        focusClass: "focus",
        itemValue: function(t) {
          return t ? t.toString() : t
        },
        itemText: function(t) {
          return this.itemValue(t)
        },
        itemTitle: function(t) {
          return null
        },
        freeInput: !0,
        addOnBlur: !0,
        maxTags: void 0,
        maxChars: void 0,
        confirmKeys: [13, 44],
        delimiter: ",",
        delimiterRegex: null,
        cancelConfirmKeysOnEmpty: !1,
        onTagExists: function(t, e) {
          e.hide().fadeIn()
        },
        trimValue: !1,
        allowDuplicates: !1,
        triggerChange: !0
      };
      function o(t, e) {
        this.isInit = !0,
            this.itemsArray = [],
            this.$element = v(t),
            this.$element.hide(),
            this.isSelect = "SELECT" === t.tagName,
            this.multiple = this.isSelect && t.hasAttribute("multiple"),
            this.objectItems = e && e.itemValue,
            this.placeholderText = t.hasAttribute("placeholder") ? this.$element.attr("placeholder") : "",
            this.inputSize = Math.max(1, this.placeholderText.length),
            this.$container = v('<div class="bootstrap-tagsinput"></div>'),
            this.$input = v('<input type="text" placeholder="' + this.placeholderText + '"/>').appendTo(this.$container),
            this.$element.before(this.$container),
            this.build(e),
            this.isInit = !1
      }
      function a(t, e) {
        if ("function" != typeof t[e]) {
          var n = t[e];
          t[e] = function(t) {
            return t[n]
          }
        }
      }
      function u(t, e) {
        if ("function" != typeof t[e]) {
          var n = t[e];
          t[e] = function() {
            return n
          }
        }
      }
      o.prototype = {
        constructor: o,
        add: function(t, e, n) {
          var i = this;
          if (!(i.options.maxTags && i.itemsArray.length >= i.options.maxTags) && (!1 === t || t)) {
            if ("string" == typeof t && i.options.trimValue && (t = v.trim(t)),
            "object" == typeof t && !i.objectItems)
              throw "Can't add objects when itemValue option is not set";
            if (!t.toString().match(/^\s*$/)) {
              if (i.isSelect && !i.multiple && 0 < i.itemsArray.length && i.remove(i.itemsArray[0]),
              "string" == typeof t && "INPUT" === this.$element[0].tagName) {
                var r = i.options.delimiterRegex ? i.options.delimiterRegex : i.options.delimiter
                    , s = t.split(r);
                if (1 < s.length) {
                  for (var o = 0; o < s.length; o++)
                    this.add(s[o], !0);
                  return void (e || i.pushVal(i.options.triggerChange))
                }
              }
              var a = i.options.itemValue(t)
                  , l = i.options.itemText(t)
                  , u = i.options.tagClass(t)
                  , c = i.options.itemTitle(t)
                  , h = v.grep(i.itemsArray, function(t) {
                return i.options.itemValue(t) === a
              })[0];
              if (!h || i.options.allowDuplicates) {
                if (!(i.items().toString().length + t.length + 1 > i.options.maxInputLength)) {
                  var f = v.Event("beforeItemAdd", {
                    item: t,
                    cancel: !1,
                    options: n
                  });
                  if (i.$element.trigger(f),
                      !f.cancel) {
                    i.itemsArray.push(t);
                    var p = v('<span class="tag ' + y(u) + (null !== c ? '" title="' + c : "") + '">' + y(l) + '<span data-role="remove"></span></span>');
                    p.data("item", t),
                        i.findInputWrapper().before(p),
                        p.after(" ");
                    var d = v('option[value="' + encodeURIComponent(a) + '"]', i.$element).length || v('option[value="' + y(a) + '"]', i.$element).length;
                    if (i.isSelect && !d) {
                      var g = v("<option selected>" + y(l) + "</option>");
                      g.data("item", t),
                          g.attr("value", a),
                          i.$element.append(g)
                    }
                    e || i.pushVal(i.options.triggerChange),
                    i.options.maxTags !== i.itemsArray.length && i.items().toString().length !== i.options.maxInputLength || i.$container.addClass("bootstrap-tagsinput-max"),
                    v(".typeahead, .twitter-typeahead", i.$container).length && i.$input.typeahead("val", ""),
                        this.isInit ? i.$element.trigger(v.Event("itemAddedOnInit", {
                          item: t,
                          options: n
                        })) : i.$element.trigger(v.Event("itemAdded", {
                          item: t,
                          options: n
                        }))
                  }
                }
              } else if (i.options.onTagExists) {
                var m = v(".tag", i.$container).filter(function() {
                  return v(this).data("item") === h
                });
                i.options.onTagExists(t, m)
              }
            }
          }
        },
        remove: function(e, t, n) {
          var i, r = this;
          if ("string" != typeof e && (e = (i = e).data("item")),
          r.objectItems && (e = (e = "object" == typeof e ? v.grep(r.itemsArray, function(t) {
            return r.options.itemValue(t) == r.options.itemValue(e)
          }) : v.grep(r.itemsArray, function(t) {
            return r.options.itemValue(t) == e
          }))[e.length - 1]),
              e) {
            var s = v.Event("beforeItemRemove", {
              item: e,
              cancel: !1,
              options: n
            });
            if (r.$element.trigger(s),
                s.cancel)
              return;
            i ? i.remove() : v(".tag", r.$container).filter(function() {
              return v(this).data("item") === e
            }).remove(),
                v("option", r.$element).filter(function() {
                  return v(this).data("item") === e
                }).remove(),
            -1 !== v.inArray(e, r.itemsArray) && r.itemsArray.splice(v.inArray(e, r.itemsArray), 1)
          }
          t || r.pushVal(r.options.triggerChange),
          r.options.maxTags > r.itemsArray.length && r.$container.removeClass("bootstrap-tagsinput-max"),
              r.$element.trigger(v.Event("itemRemoved", {
                item: e,
                options: n
              }))
        },
        removeAll: function() {
          var t = this;
          for (v(".tag", t.$container).remove(),
                   v("option", t.$element).remove(); 0 < t.itemsArray.length; )
            t.itemsArray.pop();
          t.pushVal(t.options.triggerChange)
        },
        refresh: function() {
          var s = this;
          v(".tag", s.$container).each(function() {
            var t = v(this)
                , e = t.data("item")
                , n = s.options.itemValue(e)
                , i = s.options.itemText(e)
                , r = s.options.tagClass(e);
            (t.attr("class", null),
                t.addClass("tag " + y(r)),
                t.contents().filter(function() {
                  return 3 == this.nodeType
                })[0].nodeValue = y(i),
                s.isSelect) && v("option", s.$element).filter(function() {
              return v(this).data("item") === e
            }).attr("value", n)
          })
        },
        items: function() {
          return this.itemsArray
        },
        pushVal: function() {
          var e = this
              , t = v.map(e.items(), function(t) {
            return e.options.itemValue(t).toString()
          });
          e.$element.val(t, !0),
          e.options.triggerChange && e.$element.trigger("change")
        },
        build: function(t) {
          var l = this;
          if (l.options = v.extend({}, s, t),
          l.objectItems && (l.options.freeInput = !1),
              a(l.options, "itemValue"),
              a(l.options, "itemText"),
              u(l.options, "tagClass"),
              l.options.typeahead) {
            var i = l.options.typeahead || {};
            u(i, "source"),
                l.$input.typeahead(v.extend({}, i, {
                  source: function(t, r) {
                    function e(t) {
                      for (var e = [], n = 0; n < t.length; n++) {
                        var i = l.options.itemText(t[n]);
                        s[i] = t[n],
                            e.push(i)
                      }
                      r(e)
                    }
                    this.map = {};
                    var s = this.map
                        , n = i.source(t);
                    v.isFunction(n.success) ? n.success(e) : v.isFunction(n.then) ? n.then(e) : v.when(n).then(e)
                  },
                  updater: function(t) {
                    return l.add(this.map[t]),
                        this.map[t]
                  },
                  matcher: function(t) {
                    return -1 !== t.toLowerCase().indexOf(this.query.trim().toLowerCase())
                  },
                  sorter: function(t) {
                    return t.sort()
                  },
                  highlighter: function(t) {
                    var e = new RegExp("(" + this.query + ")","gi");
                    return t.replace(e, "<strong>$1</strong>")
                  }
                }))
          }
          if (l.options.typeaheadjs) {
            var e = null
                , n = {}
                , r = l.options.typeaheadjs;
            n = v.isArray(r) ? (e = r[0],
                r[1]) : r,
                l.$input.typeahead(e, n).on("typeahead:selected", v.proxy(function(t, e) {
                  n.valueKey ? l.add(e[n.valueKey]) : l.add(e),
                      l.$input.typeahead("val", "")
                }, l))
          }
          l.$container.on("click", v.proxy(function(t) {
            l.$element.attr("disabled") || l.$input.removeAttr("disabled"),
                l.$input.focus()
          }, l)),
          l.options.addOnBlur && l.options.freeInput && l.$input.on("focusout", v.proxy(function(t) {
            0 === v(".typeahead, .twitter-typeahead", l.$container).length && (l.add(l.$input.val()),
                l.$input.val(""))
          }, l)),
              l.$container.on({
                focusin: function() {
                  l.$container.addClass(l.options.focusClass)
                },
                focusout: function() {
                  l.$container.removeClass(l.options.focusClass)
                }
              }),
              l.$container.on("keydown", "input", v.proxy(function(t) {
                var e = v(t.target)
                    , n = l.findInputWrapper();
                if (l.$element.attr("disabled"))
                  l.$input.attr("disabled", "disabled");
                else {
                  switch (t.which) {
                    case 8:
                      if (0 === c(e[0])) {
                        var i = n.prev();
                        i.length && l.remove(i)
                      }
                      break;
                    case 46:
                      if (0 === c(e[0])) {
                        var r = n.next();
                        r.length && l.remove(r)
                      }
                      break;
                    case 37:
                      var s = n.prev();
                      0 === e.val().length && s[0] && (s.before(n),
                          e.focus());
                      break;
                    case 39:
                      var o = n.next();
                      0 === e.val().length && o[0] && (o.after(n),
                          e.focus())
                  }
                  var a = e.val().length;
                  Math.ceil(a / 5);
                  e.attr("size", Math.max(this.inputSize, e.val().length))
                }
              }, l)),
              l.$container.on("keypress", "input", v.proxy(function(t) {
                var e = v(t.target);
                if (l.$element.attr("disabled"))
                  l.$input.attr("disabled", "disabled");
                else {
                  var s, n, o, i = e.val(), r = l.options.maxChars && i.length >= l.options.maxChars;
                  l.options.freeInput && (s = t,
                      n = l.options.confirmKeys,
                      o = !1,
                      v.each(n, function(t, e) {
                        if ("number" == typeof e && s.which === e)
                          return !(o = !0);
                        if (s.which === e.which) {
                          var n = !e.hasOwnProperty("altKey") || s.altKey === e.altKey
                              , i = !e.hasOwnProperty("shiftKey") || s.shiftKey === e.shiftKey
                              , r = !e.hasOwnProperty("ctrlKey") || s.ctrlKey === e.ctrlKey;
                          if (n && i && r)
                            return !(o = !0)
                        }
                      }),
                  o || r) && (0 !== i.length && (l.add(r ? i.substr(0, l.options.maxChars) : i),
                      e.val("")),
                  !1 === l.options.cancelConfirmKeysOnEmpty && t.preventDefault());
                  var a = e.val().length;
                  Math.ceil(a / 5);
                  e.attr("size", Math.max(this.inputSize, e.val().length))
                }
              }, l)),
              l.$container.on("click", "[data-role=remove]", v.proxy(function(t) {
                l.$element.attr("disabled") || l.remove(v(t.target).closest(".tag"))
              }, l)),
          l.options.itemValue === s.itemValue && ("INPUT" === l.$element[0].tagName ? l.add(l.$element.val()) : v("option", l.$element).each(function() {
            l.add(v(this).attr("value"), !0)
          }))
        },
        destroy: function() {
          var t = this;
          t.$container.off("keypress", "input"),
              t.$container.off("click", "[role=remove]"),
              t.$container.remove(),
              t.$element.removeData("tagsinput"),
              t.$element.show()
        },
        focus: function() {
          this.$input.focus()
        },
        input: function() {
          return this.$input
        },
        findInputWrapper: function() {
          for (var t = this.$input[0], e = this.$container[0]; t && t.parentNode !== e; )
            t = t.parentNode;
          return v(t)
        }
      },
          v.fn.tagsinput = function(n, i, r) {
            var s = [];
            return this.each(function() {
              var t = v(this).data("tagsinput");
              if (t)
                if (n || i) {
                  if (void 0 !== t[n]) {
                    if (3 === t[n].length && void 0 !== r)
                      var e = t[n](i, null, r);
                    else
                      e = t[n](i);
                    void 0 !== e && s.push(e)
                  }
                } else
                  s.push(t);
              else
                t = new o(this,n),
                    v(this).data("tagsinput", t),
                    s.push(t),
                "SELECT" === this.tagName && v("option", v(this)).attr("selected", "selected"),
                    v(this).val(v(this).val())
            }),
                "string" == typeof n ? 1 < s.length ? s : s[0] : s
          }
          ,
          v.fn.tagsinput.Constructor = o;
      var e = v("<div />");
      function y(t) {
        return t ? e.text(t).html() : ""
      }
      function c(t) {
        var e = 0;
        if (document.selection) {
          t.focus();
          var n = document.selection.createRange();
          n.moveStart("character", -t.value.length),
              e = n.text.length
        } else
          (t.selectionStart || "0" == t.selectionStart) && (e = t.selectionStart);
        return e
      }
      v(function() {
        v("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()
      })
    }(window.jQuery),
    function(e, n) {
      "function" == typeof define && define.amd ? define("bloodhound", ["jquery"], function(t) {
        return e.Bloodhound = n(t)
      }) : "object" == typeof exports ? module.exports = n(require("jquery")) : e.Bloodhound = n(jQuery)
    }(this, function(y) {
      var b = function() {
        "use strict";
        return {
          isMsie: function() {
            return !!/(msie|trident)/i.test(navigator.userAgent) && navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]
          },
          isBlankString: function(t) {
            return !t || /^\s*$/.test(t)
          },
          escapeRegExChars: function(t) {
            return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
          },
          isString: function(t) {
            return "string" == typeof t
          },
          isNumber: function(t) {
            return "number" == typeof t
          },
          isArray: y.isArray,
          isFunction: y.isFunction,
          isObject: y.isPlainObject,
          isUndefined: function(t) {
            return void 0 === t
          },
          isElement: function(t) {
            return !(!t || 1 !== t.nodeType)
          },
          isJQuery: function(t) {
            return t instanceof y
          },
          toStr: function(t) {
            return b.isUndefined(t) || null === t ? "" : t + ""
          },
          bind: y.proxy,
          each: function(t, n) {
            y.each(t, function(t, e) {
              return n(e, t)
            })
          },
          map: y.map,
          filter: y.grep,
          every: function(n, i) {
            var r = !0;
            return n ? (y.each(n, function(t, e) {
              if (!(r = i.call(null, e, t, n)))
                return !1
            }),
                !!r) : r
          },
          some: function(n, i) {
            var r = !1;
            return n ? (y.each(n, function(t, e) {
              if (r = i.call(null, e, t, n))
                return !1
            }),
                !!r) : r
          },
          mixin: y.extend,
          identity: function(t) {
            return t
          },
          clone: function(t) {
            return y.extend(!0, {}, t)
          },
          getIdGenerator: function() {
            var t = 0;
            return function() {
              return t++
            }
          },
          templatify: function(t) {
            return y.isFunction(t) ? t : function() {
              return String(t)
            }
          },
          defer: function(t) {
            setTimeout(t, 0)
          },
          debounce: function(r, s, o) {
            var a, l;
            return function() {
              var t, e, n = this, i = arguments;
              return t = function() {
                a = null,
                o || (l = r.apply(n, i))
              }
                  ,
                  e = o && !a,
                  clearTimeout(a),
                  a = setTimeout(t, s),
              e && (l = r.apply(n, i)),
                  l
            }
          },
          throttle: function(n, i) {
            var r, s, o, a, l, u;
            return l = 0,
                u = function() {
                  l = new Date,
                      o = null,
                      a = n.apply(r, s)
                }
                ,
                function() {
                  var t = new Date
                      , e = i - (t - l);
                  return r = this,
                      s = arguments,
                      e <= 0 ? (clearTimeout(o),
                          o = null,
                          l = t,
                          a = n.apply(r, s)) : o || (o = setTimeout(u, e)),
                      a
                }
          },
          stringify: function(t) {
            return b.isString(t) ? t : JSON.stringify(t)
          },
          noop: function() {}
        }
      }()
          , n = function() {
        "use strict";
        return {
          nonword: e,
          whitespace: t,
          obj: {
            nonword: n(e),
            whitespace: n(t)
          }
        };
        function t(t) {
          return (t = b.toStr(t)) ? t.split(/\s+/) : []
        }
        function e(t) {
          return (t = b.toStr(t)) ? t.split(/\W+/) : []
        }
        function n(i) {
          return function(t) {
            return t = b.isArray(t) ? t : [].slice.call(arguments, 0),
                function(e) {
                  var n = [];
                  return b.each(t, function(t) {
                    n = n.concat(i(b.toStr(e[t])))
                  }),
                      n
                }
          }
        }
      }()
          , i = function() {
        "use strict";
        function t(t) {
          this.maxSize = b.isNumber(t) ? t : 100,
              this.reset(),
          this.maxSize <= 0 && (this.set = this.get = y.noop)
        }
        function e() {
          this.head = this.tail = null
        }
        function r(t, e) {
          this.key = t,
              this.val = e,
              this.prev = this.next = null
        }
        return b.mixin(t.prototype, {
          set: function(t, e) {
            var n, i = this.list.tail;
            this.size >= this.maxSize && (this.list.remove(i),
                delete this.hash[i.key],
                this.size--),
                (n = this.hash[t]) ? (n.val = e,
                    this.list.moveToFront(n)) : (n = new r(t,e),
                    this.list.add(n),
                    this.hash[t] = n,
                    this.size++)
          },
          get: function(t) {
            var e = this.hash[t];
            if (e)
              return this.list.moveToFront(e),
                  e.val
          },
          reset: function() {
            this.size = 0,
                this.hash = {},
                this.list = new e
          }
        }),
            b.mixin(e.prototype, {
              add: function(t) {
                this.head && (t.next = this.head,
                    this.head.prev = t),
                    this.head = t,
                    this.tail = this.tail || t
              },
              remove: function(t) {
                t.prev ? t.prev.next = t.next : this.head = t.next,
                    t.next ? t.next.prev = t.prev : this.tail = t.prev
              },
              moveToFront: function(t) {
                this.remove(t),
                    this.add(t)
              }
            }),
            t
      }()
          , e = function() {
        "use strict";
        var s;
        try {
          (s = window.localStorage).setItem("~~~", "!"),
              s.removeItem("~~~")
        } catch (t) {
          s = null
        }
        function t(t, e) {
          this.prefix = ["__", t, "__"].join(""),
              this.ttlKey = "__ttl__",
              this.keyMatcher = new RegExp("^" + b.escapeRegExChars(this.prefix)),
              this.ls = e || s,
          !this.ls && this._noop()
        }
        return b.mixin(t.prototype, {
          _prefix: function(t) {
            return this.prefix + t
          },
          _ttlKey: function(t) {
            return this._prefix(t) + this.ttlKey
          },
          _noop: function() {
            this.get = this.set = this.remove = this.clear = this.isExpired = b.noop
          },
          _safeSet: function(t, e) {
            try {
              this.ls.setItem(t, e)
            } catch (t) {
              "QuotaExceededError" === t.name && (this.clear(),
                  this._noop())
            }
          },
          get: function(t) {
            return this.isExpired(t) && this.remove(t),
                n(this.ls.getItem(this._prefix(t)))
          },
          set: function(t, e, n) {
            return b.isNumber(n) ? this._safeSet(this._ttlKey(t), r(i() + n)) : this.ls.removeItem(this._ttlKey(t)),
                this._safeSet(this._prefix(t), r(e))
          },
          remove: function(t) {
            return this.ls.removeItem(this._ttlKey(t)),
                this.ls.removeItem(this._prefix(t)),
                this
          },
          clear: function() {
            var t, e = function(t) {
              var e, n, i = [], r = s.length;
              for (e = 0; e < r; e++)
                (n = s.key(e)).match(t) && i.push(n.replace(t, ""));
              return i
            }(this.keyMatcher);
            for (t = e.length; t--; )
              this.remove(e[t]);
            return this
          },
          isExpired: function(t) {
            var e = n(this.ls.getItem(this._ttlKey(t)));
            return !!(b.isNumber(e) && i() > e)
          }
        }),
            t;
        function i() {
          return (new Date).getTime()
        }
        function r(t) {
          return JSON.stringify(b.isUndefined(t) ? null : t)
        }
        function n(t) {
          return y.parseJSON(t)
        }
      }()
          , r = function() {
        "use strict";
        var a = 0
            , l = {}
            , u = 6
            , e = new i(10);
        function t(t) {
          t = t || {},
              this.cancelled = !1,
              this.lastReq = null,
              this._send = t.transport,
              this._get = t.limiter ? t.limiter(this._get) : this._get,
              this._cache = !1 === t.cache ? new i(0) : e
        }
        return t.setMaxPendingRequests = function(t) {
          u = t
        }
            ,
            t.resetCache = function() {
              e.reset()
            }
            ,
            b.mixin(t.prototype, {
              _fingerprint: function(t) {
                return (t = t || {}).url + t.type + y.param(t.data || {})
              },
              _get: function(t, e) {
                var n, i, r = this;
                function s(t) {
                  e(null, t),
                      r._cache.set(n, t)
                }
                function o() {
                  e(!0)
                }
                n = this._fingerprint(t),
                this.cancelled || n !== this.lastReq || ((i = l[n]) ? i.done(s).fail(o) : a < u ? (a++,
                    l[n] = this._send(t).done(s).fail(o).always(function() {
                      a--,
                          delete l[n],
                      r.onDeckRequestArgs && (r._get.apply(r, r.onDeckRequestArgs),
                          r.onDeckRequestArgs = null)
                    })) : this.onDeckRequestArgs = [].slice.call(arguments, 0))
              },
              get: function(t, e) {
                var n, i;
                e = e || y.noop,
                    t = b.isString(t) ? {
                      url: t
                    } : t || {},
                    i = this._fingerprint(t),
                    this.cancelled = !1,
                    this.lastReq = i,
                    (n = this._cache.get(i)) ? e(null, n) : this._get(t, e)
              },
              cancel: function() {
                this.cancelled = !0
              }
            }),
            t
      }()
          , s = window.SearchIndex = function() {
        "use strict";
        var a = "c"
            , l = "i";
        function t(t) {
          (t = t || {}).datumTokenizer && t.queryTokenizer || y.error("datumTokenizer and queryTokenizer are both required"),
              this.identify = t.identify || b.stringify,
              this.datumTokenizer = t.datumTokenizer,
              this.queryTokenizer = t.queryTokenizer,
              this.reset()
        }
        return b.mixin(t.prototype, {
          bootstrap: function(t) {
            this.datums = t.datums,
                this.trie = t.trie
          },
          add: function(t) {
            var s = this;
            t = b.isArray(t) ? t : [t],
                b.each(t, function(t) {
                  var r, e;
                  s.datums[r = s.identify(t)] = t,
                      e = n(s.datumTokenizer(t)),
                      b.each(e, function(t) {
                        var e, n, i;
                        for (e = s.trie,
                                 n = t.split(""); i = n.shift(); )
                          (e = e[a][i] || (e[a][i] = o()))[l].push(r)
                      })
                })
          },
          get: function(t) {
            var e = this;
            return b.map(t, function(t) {
              return e.datums[t]
            })
          },
          search: function(t) {
            var e, s, o = this;
            return e = n(this.queryTokenizer(t)),
                b.each(e, function(t) {
                  var e, n, i, r;
                  if (s && 0 === s.length)
                    return !1;
                  for (e = o.trie,
                           n = t.split(""); e && (i = n.shift()); )
                    e = e[a][i];
                  if (!e || 0 !== n.length)
                    return !(s = []);
                  r = e[l].slice(0),
                      s = s ? function(t, e) {
                        var n = 0
                            , i = 0
                            , r = [];
                        t = t.sort(),
                            e = e.sort();
                        var s = t.length
                            , o = e.length;
                        for (; n < s && i < o; )
                          t[n] < e[i] ? n++ : (t[n] > e[i] || (r.push(t[n]),
                              n++),
                              i++);
                        return r
                      }(s, r) : r
                }),
                s ? b.map(function(t) {
                  for (var e = {}, n = [], i = 0, r = t.length; i < r; i++)
                    e[t[i]] || (e[t[i]] = !0,
                        n.push(t[i]));
                  return n
                }(s), function(t) {
                  return o.datums[t]
                }) : []
          },
          all: function() {
            var t = [];
            for (var e in this.datums)
              t.push(this.datums[e]);
            return t
          },
          reset: function() {
            this.datums = {},
                this.trie = o()
          },
          serialize: function() {
            return {
              datums: this.datums,
              trie: this.trie
            }
          }
        }),
            t;
        function n(t) {
          return t = b.filter(t, function(t) {
            return !!t
          }),
              t = b.map(t, function(t) {
                return t.toLowerCase()
              })
        }
        function o() {
          var t = {};
          return t[l] = [],
              t[a] = {},
              t
        }
      }()
          , o = function() {
        "use strict";
        var n;
        function t(t) {
          this.url = t.url,
              this.ttl = t.ttl,
              this.cache = t.cache,
              this.prepare = t.prepare,
              this.transform = t.transform,
              this.transport = t.transport,
              this.thumbprint = t.thumbprint,
              this.storage = new e(t.cacheKey)
        }
        return n = {
          data: "data",
          protocol: "protocol",
          thumbprint: "thumbprint"
        },
            b.mixin(t.prototype, {
              _settings: function() {
                return {
                  url: this.url,
                  type: "GET",
                  dataType: "json"
                }
              },
              store: function(t) {
                this.cache && (this.storage.set(n.data, t, this.ttl),
                    this.storage.set(n.protocol, location.protocol, this.ttl),
                    this.storage.set(n.thumbprint, this.thumbprint, this.ttl))
              },
              fromCache: function() {
                var t, e = {};
                return this.cache ? (e.data = this.storage.get(n.data),
                    e.protocol = this.storage.get(n.protocol),
                    e.thumbprint = this.storage.get(n.thumbprint),
                    t = e.thumbprint !== this.thumbprint || e.protocol !== location.protocol,
                    e.data && !t ? e.data : null) : null
              },
              fromNetwork: function(e) {
                var t, n = this;
                e && (t = this.prepare(this._settings()),
                    this.transport(t).fail(function() {
                      e(!0)
                    }).done(function(t) {
                      e(null, n.transform(t))
                    }))
              },
              clear: function() {
                return this.storage.clear(),
                    this
              }
            }),
            t
      }()
          , a = function() {
        "use strict";
        function t(t) {
          this.url = t.url,
              this.prepare = t.prepare,
              this.transform = t.transform,
              this.transport = new r({
                cache: t.cache,
                limiter: t.limiter,
                transport: t.transport
              })
        }
        return b.mixin(t.prototype, {
          _settings: function() {
            return {
              url: this.url,
              type: "GET",
              dataType: "json"
            }
          },
          get: function(t, n) {
            var e, i = this;
            if (n)
              return t = t || "",
                  e = this.prepare(t, this._settings()),
                  this.transport.get(e, function(t, e) {
                    n(t ? [] : i.transform(e))
                  })
          },
          cancelLastRequest: function() {
            this.transport.cancel()
          }
        }),
            t
      }()
          , l = function() {
        "use strict";
        return function(t) {
          var e, n, i, r, s, o, a, l, u, c, h, f, p, d, g, m;
          return e = {
            initialize: !0,
            identify: b.stringify,
            datumTokenizer: null,
            queryTokenizer: null,
            sufficient: 5,
            sorter: null,
            local: [],
            prefetch: null,
            remote: null
          },
          !(t = b.mixin(e, t || {})).datumTokenizer && y.error("datumTokenizer is required"),
          !t.queryTokenizer && y.error("queryTokenizer is required"),
              n = t.sorter,
              t.sorter = n ? function(t) {
                    return t.sort(n)
                  }
                  : b.identity,
              t.local = b.isFunction(t.local) ? t.local() : t.local,
              t.prefetch = (i = t.prefetch) ? (r = {
                url: null,
                ttl: 864e5,
                cache: !0,
                cacheKey: null,
                thumbprint: "",
                prepare: b.identity,
                transform: b.identity,
                transport: null
              },
                  i = b.isString(i) ? {
                    url: i
                  } : i,
              !(i = b.mixin(r, i)).url && y.error("prefetch requires url to be set"),
                  i.transform = i.filter || i.transform,
                  i.cacheKey = i.cacheKey || i.url,
                  i.thumbprint = "0.11.1" + i.thumbprint,
                  i.transport = i.transport ? v(i.transport) : y.ajax,
                  i) : null,
              t.remote = (s = t.remote) ? (o = {
                url: null,
                cache: !0,
                prepare: null,
                replace: null,
                wildcard: null,
                limiter: null,
                rateLimitBy: "debounce",
                rateLimitWait: 300,
                transform: b.identity,
                transport: null
              },
                  s = b.isString(s) ? {
                    url: s
                  } : s,
              !(s = b.mixin(o, s)).url && y.error("remote requires url to be set"),
                  s.transform = s.filter || s.transform,
                  s.prepare = (d = (p = s).prepare,
                      g = p.replace,
                      m = p.wildcard,
                  d || (d = g ? function(t, e) {
                            return e.url = g(e.url, t),
                                e
                          }
                          : p.wildcard ? function(t, e) {
                                return e.url = e.url.replace(m, encodeURIComponent(t)),
                                    e
                              }
                              : function(t, e) {
                                return e
                              }
                  )),
                  s.limiter = (l = (a = s).limiter,
                      u = a.rateLimitBy,
                      c = a.rateLimitWait,
                  l || (l = /^throttle$/i.test(u) ? (f = c,
                          function(t) {
                            return b.throttle(t, f)
                          }
                  ) : (h = c,
                          function(t) {
                            return b.debounce(t, h)
                          }
                  )),
                      l),
                  s.transport = s.transport ? v(s.transport) : y.ajax,
                  delete s.replace,
                  delete s.wildcard,
                  delete s.rateLimitBy,
                  delete s.rateLimitWait,
                  s) : void 0,
              t
        }
            ;
        function v(n) {
          return function(t) {
            var e = y.Deferred();
            return n(t, function(t) {
              b.defer(function() {
                e.resolve(t)
              })
            }, function(t) {
              b.defer(function() {
                e.reject(t)
              })
            }),
                e
          }
        }
      }();
      return function() {
        "use strict";
        var t;
        function e(t) {
          t = l(t),
              this.sorter = t.sorter,
              this.identify = t.identify,
              this.sufficient = t.sufficient,
              this.local = t.local,
              this.remote = t.remote ? new a(t.remote) : null,
              this.prefetch = t.prefetch ? new o(t.prefetch) : null,
              this.index = new s({
                identify: this.identify,
                datumTokenizer: t.datumTokenizer,
                queryTokenizer: t.queryTokenizer
              }),
          !1 !== t.initialize && this.initialize()
        }
        return t = window && window.Bloodhound,
            e.noConflict = function() {
              return window && (window.Bloodhound = t),
                  e
            }
            ,
            e.tokenizers = n,
            b.mixin(e.prototype, {
              __ttAdapter: function() {
                var i = this;
                return this.remote ? function(t, e, n) {
                      return i.search(t, e, n)
                    }
                    : function(t, e) {
                      return i.search(t, e)
                    }
              },
              _loadPrefetch: function() {
                var n, t, i = this;
                return n = y.Deferred(),
                    this.prefetch ? (t = this.prefetch.fromCache()) ? (this.index.bootstrap(t),
                        n.resolve()) : this.prefetch.fromNetwork(function(t, e) {
                      if (t)
                        return n.reject();
                      i.add(e),
                          i.prefetch.store(i.index.serialize()),
                          n.resolve()
                    }) : n.resolve(),
                    n.promise()
              },
              _initialize: function() {
                var t = this;
                return this.clear(),
                    (this.initPromise = this._loadPrefetch()).done(function() {
                      t.add(t.local)
                    }),
                    this.initPromise
              },
              initialize: function(t) {
                return !this.initPromise || t ? this._initialize() : this.initPromise
              },
              add: function(t) {
                return this.index.add(t),
                    this
              },
              get: function(t) {
                return t = b.isArray(t) ? t : [].slice.call(arguments),
                    this.index.get(t)
              },
              search: function(t, e, i) {
                var r, s = this;
                return r = this.sorter(this.index.search(t)),
                    e(this.remote ? r.slice() : r),
                    this.remote && r.length < this.sufficient ? this.remote.get(t, function(t) {
                      var n = [];
                      b.each(t, function(e) {
                        !b.some(r, function(t) {
                          return s.identify(e) === s.identify(t)
                        }) && n.push(e)
                      }),
                      i && i(n)
                    }) : this.remote && this.remote.cancelLastRequest(),
                    this
              },
              all: function() {
                return this.index.all()
              },
              clear: function() {
                return this.index.reset(),
                    this
              },
              clearPrefetchCache: function() {
                return this.prefetch && this.prefetch.clear(),
                    this
              },
              clearRemoteCache: function() {
                return r.resetCache(),
                    this
              },
              ttAdapter: function() {
                return this.__ttAdapter()
              }
            }),
            e
      }()
    }),
    function(t, e) {
      "function" == typeof define && define.amd ? define("typeahead.js", ["jquery"], function(t) {
        return e(t)
      }) : "object" == typeof exports ? module.exports = e(require("jquery")) : e(jQuery)
    }(0, function(b) {
      var _ = function() {
        "use strict";
        return {
          isMsie: function() {
            return !!/(msie|trident)/i.test(navigator.userAgent) && navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]
          },
          isBlankString: function(t) {
            return !t || /^\s*$/.test(t)
          },
          escapeRegExChars: function(t) {
            return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
          },
          isString: function(t) {
            return "string" == typeof t
          },
          isNumber: function(t) {
            return "number" == typeof t
          },
          isArray: b.isArray,
          isFunction: b.isFunction,
          isObject: b.isPlainObject,
          isUndefined: function(t) {
            return void 0 === t
          },
          isElement: function(t) {
            return !(!t || 1 !== t.nodeType)
          },
          isJQuery: function(t) {
            return t instanceof b
          },
          toStr: function(t) {
            return _.isUndefined(t) || null === t ? "" : t + ""
          },
          bind: b.proxy,
          each: function(t, n) {
            b.each(t, function(t, e) {
              return n(e, t)
            })
          },
          map: b.map,
          filter: b.grep,
          every: function(n, i) {
            var r = !0;
            return n ? (b.each(n, function(t, e) {
              if (!(r = i.call(null, e, t, n)))
                return !1
            }),
                !!r) : r
          },
          some: function(n, i) {
            var r = !1;
            return n ? (b.each(n, function(t, e) {
              if (r = i.call(null, e, t, n))
                return !1
            }),
                !!r) : r
          },
          mixin: b.extend,
          identity: function(t) {
            return t
          },
          clone: function(t) {
            return b.extend(!0, {}, t)
          },
          getIdGenerator: function() {
            var t = 0;
            return function() {
              return t++
            }
          },
          templatify: function(t) {
            return b.isFunction(t) ? t : function() {
              return String(t)
            }
          },
          defer: function(t) {
            setTimeout(t, 0)
          },
          debounce: function(r, s, o) {
            var a, l;
            return function() {
              var t, e, n = this, i = arguments;
              return t = function() {
                a = null,
                o || (l = r.apply(n, i))
              }
                  ,
                  e = o && !a,
                  clearTimeout(a),
                  a = setTimeout(t, s),
              e && (l = r.apply(n, i)),
                  l
            }
          },
          throttle: function(n, i) {
            var r, s, o, a, l, u;
            return l = 0,
                u = function() {
                  l = new Date,
                      o = null,
                      a = n.apply(r, s)
                }
                ,
                function() {
                  var t = new Date
                      , e = i - (t - l);
                  return r = this,
                      s = arguments,
                      e <= 0 ? (clearTimeout(o),
                          o = null,
                          l = t,
                          a = n.apply(r, s)) : o || (o = setTimeout(u, e)),
                      a
                }
          },
          stringify: function(t) {
            return _.isString(t) ? t : JSON.stringify(t)
          },
          noop: function() {}
        }
      }()
          , n = function() {
        "use strict";
        var a = {
          wrapper: "twitter-typeahead",
          input: "tt-input",
          hint: "tt-hint",
          menu: "tt-menu",
          dataset: "tt-dataset",
          suggestion: "tt-suggestion",
          selectable: "tt-selectable",
          empty: "tt-empty",
          open: "tt-open",
          cursor: "tt-cursor",
          highlight: "tt-highlight"
        };
        return function(t) {
          var e, n;
          return n = _.mixin({}, a, t),
              {
                css: (e = {
                  css: (o = {
                    wrapper: {
                      position: "relative",
                      display: "inline-block"
                    },
                    hint: {
                      position: "absolute",
                      top: "0",
                      left: "0",
                      borderColor: "transparent",
                      boxShadow: "none",
                      opacity: "1"
                    },
                    input: {
                      position: "relative",
                      verticalAlign: "top",
                      backgroundColor: "transparent"
                    },
                    inputWithNoHint: {
                      position: "relative",
                      verticalAlign: "top"
                    },
                    menu: {
                      position: "absolute",
                      top: "100%",
                      left: "0",
                      zIndex: "100",
                      display: "none"
                    },
                    ltr: {
                      left: "0",
                      right: "auto"
                    },
                    rtl: {
                      left: "auto",
                      right: " 0"
                    }
                  },
                  _.isMsie() && _.mixin(o.input, {
                    backgroundImage: "url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"
                  }),
                      o),
                  classes: n,
                  html: (s = n,
                      {
                        wrapper: '<span class="' + s.wrapper + '"></span>',
                        menu: '<div class="' + s.menu + '"></div>'
                      }),
                  selectors: (i = n,
                      r = {},
                      _.each(i, function(t, e) {
                        r[e] = "." + t
                      }),
                      r)
                }).css,
                html: e.html,
                classes: e.classes,
                selectors: e.selectors,
                mixin: function(t) {
                  _.mixin(t, e)
                }
              };
          var i, r;
          var s;
          var o
        }
      }()
          , w = function() {
        "use strict";
        var n;
        function t(t) {
          t && t.el || b.error("EventBus initialized without el"),
              this.$el = b(t.el)
        }
        return "typeahead:",
            n = {
              render: "rendered",
              cursorchange: "cursorchanged",
              select: "selected",
              autocomplete: "autocompleted"
            },
            _.mixin(t.prototype, {
              _trigger: function(t, e) {
                var n;
                return n = b.Event("typeahead:" + t),
                    (e = e || []).unshift(n),
                    this.$el.trigger.apply(this.$el, e),
                    n
              },
              before: function(t) {
                var e;
                return e = [].slice.call(arguments, 1),
                    this._trigger("before" + t, e).isDefaultPrevented()
              },
              trigger: function(t) {
                var e;
                this._trigger(t, [].slice.call(arguments, 1)),
                (e = n[t]) && this._trigger(e, [].slice.call(arguments, 1))
              }
            }),
            t
      }()
          , e = function() {
        "use strict";
        var a = /\s+/
            , o = function() {
          var t;
          t = window.setImmediate ? function(t) {
                setImmediate(function() {
                  t()
                })
              }
              : function(t) {
                setTimeout(function() {
                  t()
                }, 0)
              }
          ;
          return t
        }();
        return {
          onSync: function(t, e, n) {
            return i.call(this, "sync", t, e, n)
          },
          onAsync: function(t, e, n) {
            return i.call(this, "async", t, e, n)
          },
          off: function(t) {
            var e;
            if (!this._callbacks)
              return this;
            t = t.split(a);
            for (; e = t.shift(); )
              delete this._callbacks[e];
            return this
          },
          trigger: function(t) {
            var e, n, i, r, s;
            if (!this._callbacks)
              return this;
            t = t.split(a),
                i = [].slice.call(arguments, 1);
            for (; (e = t.shift()) && (n = this._callbacks[e]); )
              r = l(n.sync, this, [e].concat(i)),
                  s = l(n.async, this, [e].concat(i)),
              r() && o(s);
            return this
          }
        };
        function i(t, e, n, i) {
          var r, s, o;
          if (!n)
            return this;
          for (e = e.split(a),
                   n = i ? (o = i,
                           (s = n).bind ? s.bind(o) : function() {
                             s.apply(o, [].slice.call(arguments, 0))
                           }
                   ) : n,
                   this._callbacks = this._callbacks || {}; r = e.shift(); )
            this._callbacks[r] = this._callbacks[r] || {
              sync: [],
              async: []
            },
                this._callbacks[r][t].push(n);
          return this
        }
        function l(i, r, s) {
          return function() {
            for (var t, e = 0, n = i.length; !t && e < n; e += 1)
              t = !1 === i[e].apply(r, s);
            return !t
          }
        }
      }()
          , l = function(o) {
        "use strict";
        var t = {
          node: null,
          pattern: null,
          tagName: "strong",
          className: null,
          wordsOnly: !1,
          caseSensitive: !1
        };
        return function(r) {
          var s;
          (r = _.mixin({}, t, r)).node && r.pattern && (r.pattern = _.isArray(r.pattern) ? r.pattern : [r.pattern],
              s = function(t, e, n) {
                for (var i, r = [], s = 0, o = t.length; s < o; s++)
                  r.push(_.escapeRegExChars(t[s]));
                return i = n ? "\\b(" + r.join("|") + ")\\b" : "(" + r.join("|") + ")",
                    e ? new RegExp(i) : new RegExp(i,"i")
              }(r.pattern, r.caseSensitive, r.wordsOnly),
              function t(e, n) {
                var i;
                for (var r = 0; r < e.childNodes.length; r++)
                  3 === (i = e.childNodes[r]).nodeType ? r += n(i) ? 1 : 0 : t(i, n)
              }(r.node, function(t) {
                var e, n, i;
                (e = s.exec(t.data)) && (i = o.createElement(r.tagName),
                r.className && (i.className = r.className),
                    (n = t.splitText(e.index)).splitText(e[0].length),
                    i.appendChild(n.cloneNode(!0)),
                    t.parentNode.replaceChild(i, n));
                return !!e
              }))
        }
      }(window.document)
          , x = function() {
        "use strict";
        var s;
        function o(t, e) {
          var n;
          (t = t || {}).input || b.error("input is missing"),
              e.mixin(this),
              this.$hint = b(t.hint),
              this.$input = b(t.input),
              this.query = this.$input.val(),
              this.queryWhenFocused = this.hasFocus() ? this.query : null,
              this.$overflowHelper = (n = this.$input,
                  b('<pre aria-hidden="true"></pre>').css({
                    position: "absolute",
                    visibility: "hidden",
                    whiteSpace: "pre",
                    fontFamily: n.css("font-family"),
                    fontSize: n.css("font-size"),
                    fontStyle: n.css("font-style"),
                    fontVariant: n.css("font-variant"),
                    fontWeight: n.css("font-weight"),
                    wordSpacing: n.css("word-spacing"),
                    letterSpacing: n.css("letter-spacing"),
                    textIndent: n.css("text-indent"),
                    textRendering: n.css("text-rendering"),
                    textTransform: n.css("text-transform")
                  }).insertAfter(n)),
              this._checkLanguageDirection(),
          0 === this.$hint.length && (this.setHint = this.getHint = this.clearHint = this.clearHintIfInvalid = _.noop)
        }
        return s = {
          27: "esc",
          37: "left",
          39: "right",
          13: "enter",
          38: "up",
          40: "down"
        },
            o.normalizeQuery = function(t) {
              return _.toStr(t).replace(/^\s*/g, "").replace(/\s{2,}/g, " ")
            }
            ,
            _.mixin(o.prototype, e, {
              _onBlur: function() {
                this.resetInputValue(),
                    this.trigger("blurred")
              },
              _onFocus: function() {
                this.queryWhenFocused = this.query,
                    this.trigger("focused")
              },
              _onKeydown: function(t) {
                var e = s[t.which || t.keyCode];
                this._managePreventDefault(e, t),
                e && this._shouldTrigger(e, t) && this.trigger(e + "Keyed", t)
              },
              _onInput: function() {
                this._setQuery(this.getInputValue()),
                    this.clearHintIfInvalid(),
                    this._checkLanguageDirection()
              },
              _managePreventDefault: function(t, e) {
                var n;
                switch (t) {
                  case "up":
                  case "down":
                    n = !i(e);
                    break;
                  default:
                    n = !1
                }
                n && e.preventDefault()
              },
              _shouldTrigger: function(t, e) {
                var n;
                switch (t) {
                  case "tab":
                    n = !i(e);
                    break;
                  default:
                    n = !0
                }
                return n
              },
              _checkLanguageDirection: function() {
                var t = (this.$input.css("direction") || "ltr").toLowerCase();
                this.dir !== t && (this.dir = t,
                    this.$hint.attr("dir", t),
                    this.trigger("langDirChanged", t))
              },
              _setQuery: function(t, e) {
                var n, i, r, s;
                r = t,
                    s = this.query,
                    i = !!(n = o.normalizeQuery(r) === o.normalizeQuery(s)) && this.query.length !== t.length,
                    this.query = t,
                    e || n ? !e && i && this.trigger("whitespaceChanged", this.query) : this.trigger("queryChanged", this.query)
              },
              bind: function() {
                var t, e, n, i, r = this;
                return t = _.bind(this._onBlur, this),
                    e = _.bind(this._onFocus, this),
                    n = _.bind(this._onKeydown, this),
                    i = _.bind(this._onInput, this),
                    this.$input.on("blur.tt", t).on("focus.tt", e).on("keydown.tt", n),
                    !_.isMsie() || 9 < _.isMsie() ? this.$input.on("input.tt", i) : this.$input.on("keydown.tt keypress.tt cut.tt paste.tt", function(t) {
                      s[t.which || t.keyCode] || _.defer(_.bind(r._onInput, r, t))
                    }),
                    this
              },
              focus: function() {
                this.$input.focus()
              },
              blur: function() {
                this.$input.blur()
              },
              getLangDir: function() {
                return this.dir
              },
              getQuery: function() {
                return this.query || ""
              },
              setQuery: function(t, e) {
                this.setInputValue(t),
                    this._setQuery(t, e)
              },
              hasQueryChangedSinceLastFocus: function() {
                return this.query !== this.queryWhenFocused
              },
              getInputValue: function() {
                return this.$input.val()
              },
              setInputValue: function(t) {
                this.$input.val(t),
                    this.clearHintIfInvalid(),
                    this._checkLanguageDirection()
              },
              resetInputValue: function() {
                this.setInputValue(this.query)
              },
              getHint: function() {
                return this.$hint.val()
              },
              setHint: function(t) {
                this.$hint.val(t)
              },
              clearHint: function() {
                this.setHint("")
              },
              clearHintIfInvalid: function() {
                var t, e, n;
                n = (t = this.getInputValue()) !== (e = this.getHint()) && 0 === e.indexOf(t),
                !("" !== t && n && !this.hasOverflow()) && this.clearHint()
              },
              hasFocus: function() {
                return this.$input.is(":focus")
              },
              hasOverflow: function() {
                var t = this.$input.width() - 2;
                return this.$overflowHelper.text(this.getInputValue()),
                this.$overflowHelper.width() >= t
              },
              isCursorAtEnd: function() {
                var t, e, n;
                return t = this.$input.val().length,
                    e = this.$input[0].selectionStart,
                    _.isNumber(e) ? e === t : !document.selection || ((n = document.selection.createRange()).moveStart("character", -t),
                    t === n.text.length)
              },
              destroy: function() {
                this.$hint.off(".tt"),
                    this.$input.off(".tt"),
                    this.$overflowHelper.remove(),
                    this.$hint = this.$input = this.$overflowHelper = b("<div>")
              }
            }),
            o;
        function i(t) {
          return t.altKey || t.ctrlKey || t.metaKey || t.shiftKey
        }
      }()
          , r = function() {
        "use strict";
        var o, a;
        function t(t, e) {
          var n, i, r, s;
          (t = t || {}).templates = t.templates || {},
              t.templates.notFound = t.templates.notFound || t.templates.empty,
          t.source || b.error("missing source"),
          t.node || b.error("missing node"),
          t.name && (n = t.name,
              !/^[_a-zA-Z0-9-]+$/.test(n)) && b.error("invalid dataset name: " + t.name),
              e.mixin(this),
              this.highlight = !!t.highlight,
              this.name = t.name || a(),
              this.limit = t.limit || 5,
              this.displayFn = (i = (i = t.display || t.displayKey) || _.stringify,
                      _.isFunction(i) ? i : function(t) {
                        return t[i]
                      }
              ),
              this.templates = (r = t.templates,
                  s = this.displayFn,
                  {
                    notFound: r.notFound && _.templatify(r.notFound),
                    pending: r.pending && _.templatify(r.pending),
                    header: r.header && _.templatify(r.header),
                    footer: r.footer && _.templatify(r.footer),
                    suggestion: r.suggestion || function(t) {
                      return b("<div>").text(s(t))
                    }
                  }),
              this.source = t.source.__ttAdapter ? t.source.__ttAdapter() : t.source,
              this.async = _.isUndefined(t.async) ? 2 < this.source.length : !!t.async,
              this._resetLastSuggestion(),
              this.$el = b(t.node).addClass(this.classes.dataset).addClass(this.classes.dataset + "-" + this.name)
        }
        return o = {
          val: "tt-selectable-display",
          obj: "tt-selectable-object"
        },
            a = _.getIdGenerator(),
            t.extractData = function(t) {
              var e = b(t);
              return e.data(o.obj) ? {
                val: e.data(o.val) || "",
                obj: e.data(o.obj) || null
              } : null
            }
            ,
            _.mixin(t.prototype, e, {
              _overwrite: function(t, e) {
                (e = e || []).length ? this._renderSuggestions(t, e) : this.async && this.templates.pending ? this._renderPending(t) : !this.async && this.templates.notFound ? this._renderNotFound(t) : this._empty(),
                    this.trigger("rendered", this.name, e, !1)
              },
              _append: function(t, e) {
                (e = e || []).length && this.$lastSuggestion.length ? this._appendSuggestions(t, e) : e.length ? this._renderSuggestions(t, e) : !this.$lastSuggestion.length && this.templates.notFound && this._renderNotFound(t),
                    this.trigger("rendered", this.name, e, !0)
              },
              _renderSuggestions: function(t, e) {
                var n;
                n = this._getSuggestionsFragment(t, e),
                    this.$lastSuggestion = n.children().last(),
                    this.$el.html(n).prepend(this._getHeader(t, e)).append(this._getFooter(t, e))
              },
              _appendSuggestions: function(t, e) {
                var n, i;
                i = (n = this._getSuggestionsFragment(t, e)).children().last(),
                    this.$lastSuggestion.after(n),
                    this.$lastSuggestion = i
              },
              _renderPending: function(t) {
                var e = this.templates.pending;
                this._resetLastSuggestion(),
                e && this.$el.html(e({
                  query: t,
                  dataset: this.name
                }))
              },
              _renderNotFound: function(t) {
                var e = this.templates.notFound;
                this._resetLastSuggestion(),
                e && this.$el.html(e({
                  query: t,
                  dataset: this.name
                }))
              },
              _empty: function() {
                this.$el.empty(),
                    this._resetLastSuggestion()
              },
              _getSuggestionsFragment: function(i, t) {
                var r, s = this;
                return r = document.createDocumentFragment(),
                    _.each(t, function(t) {
                      var e, n;
                      n = s._injectQuery(i, t),
                          e = b(s.templates.suggestion(n)).data(o.obj, t).data(o.val, s.displayFn(t)).addClass(s.classes.suggestion + " " + s.classes.selectable),
                          r.appendChild(e[0])
                    }),
                this.highlight && l({
                  className: this.classes.highlight,
                  node: r,
                  pattern: i
                }),
                    b(r)
              },
              _getFooter: function(t, e) {
                return this.templates.footer ? this.templates.footer({
                  query: t,
                  suggestions: e,
                  dataset: this.name
                }) : null
              },
              _getHeader: function(t, e) {
                return this.templates.header ? this.templates.header({
                  query: t,
                  suggestions: e,
                  dataset: this.name
                }) : null
              },
              _resetLastSuggestion: function() {
                this.$lastSuggestion = b()
              },
              _injectQuery: function(t, e) {
                return _.isObject(e) ? _.mixin({
                  _query: t
                }, e) : e
              },
              update: function(e) {
                var n = this
                    , i = !1
                    , r = !1
                    , s = 0;
                function t(t) {
                  r || (r = !0,
                      t = (t || []).slice(0, n.limit),
                      s = t.length,
                      n._overwrite(e, t),
                  s < n.limit && n.async && n.trigger("asyncRequested", e))
                }
                this.cancel(),
                    this.cancel = function() {
                      i = !0,
                          n.cancel = b.noop,
                      n.async && n.trigger("asyncCanceled", e)
                    }
                    ,
                    this.source(e, t, function(t) {
                      t = t || [],
                      !i && s < n.limit && (n.cancel = b.noop,
                          s += t.length,
                          n._append(e, t.slice(0, n.limit - s)),
                      n.async && n.trigger("asyncReceived", e))
                    }),
                !r && t([])
              },
              cancel: b.noop,
              clear: function() {
                this._empty(),
                    this.cancel(),
                    this.trigger("cleared")
              },
              isEmpty: function() {
                return this.$el.is(":empty")
              },
              destroy: function() {
                this.$el = b("<div>")
              }
            }),
            t
      }()
          , A = function() {
        "use strict";
        function t(t, n) {
          var i = this;
          (t = t || {}).node || b.error("node is required"),
              n.mixin(this),
              this.$node = b(t.node),
              this.query = null,
              this.datasets = _.map(t.datasets, function(t) {
                var e = i.$node.find(t.node).first();
                return t.node = e.length ? e : b("<div>").appendTo(i.$node),
                    new r(t,n)
              })
        }
        return _.mixin(t.prototype, e, {
          _onSelectableClick: function(t) {
            this.trigger("selectableClicked", b(t.currentTarget))
          },
          _onRendered: function(t, e, n, i) {
            this.$node.toggleClass(this.classes.empty, this._allDatasetsEmpty()),
                this.trigger("datasetRendered", e, n, i)
          },
          _onCleared: function() {
            this.$node.toggleClass(this.classes.empty, this._allDatasetsEmpty()),
                this.trigger("datasetCleared")
          },
          _propagate: function() {
            this.trigger.apply(this, arguments)
          },
          _allDatasetsEmpty: function() {
            return _.every(this.datasets, function(t) {
              return t.isEmpty()
            })
          },
          _getSelectables: function() {
            return this.$node.find(this.selectors.selectable)
          },
          _removeCursor: function() {
            var t = this.getActiveSelectable();
            t && t.removeClass(this.classes.cursor)
          },
          _ensureVisible: function(t) {
            var e, n, i, r;
            n = (e = t.position().top) + t.outerHeight(!0),
                i = this.$node.scrollTop(),
                r = this.$node.height() + parseInt(this.$node.css("paddingTop"), 10) + parseInt(this.$node.css("paddingBottom"), 10),
                e < 0 ? this.$node.scrollTop(i + e) : r < n && this.$node.scrollTop(i + (n - r))
          },
          bind: function() {
            var t, e = this;
            return t = _.bind(this._onSelectableClick, this),
                this.$node.on("click.tt", this.selectors.selectable, t),
                _.each(this.datasets, function(t) {
                  t.onSync("asyncRequested", e._propagate, e).onSync("asyncCanceled", e._propagate, e).onSync("asyncReceived", e._propagate, e).onSync("rendered", e._onRendered, e).onSync("cleared", e._onCleared, e)
                }),
                this
          },
          isOpen: function() {
            return this.$node.hasClass(this.classes.open)
          },
          open: function() {
            this.$node.addClass(this.classes.open)
          },
          close: function() {
            this.$node.removeClass(this.classes.open),
                this._removeCursor()
          },
          setLanguageDirection: function(t) {
            this.$node.attr("dir", t)
          },
          selectableRelativeToCursor: function(t) {
            var e, n, i;
            return n = this.getActiveSelectable(),
                e = this._getSelectables(),
                -1 === (i = (i = ((i = (n ? e.index(n) : -1) + t) + 1) % (e.length + 1) - 1) < -1 ? e.length - 1 : i) ? null : e.eq(i)
          },
          setCursor: function(t) {
            this._removeCursor(),
            (t = t && t.first()) && (t.addClass(this.classes.cursor),
                this._ensureVisible(t))
          },
          getSelectableData: function(t) {
            return t && t.length ? r.extractData(t) : null
          },
          getActiveSelectable: function() {
            var t = this._getSelectables().filter(this.selectors.cursor).first();
            return t.length ? t : null
          },
          getTopSelectable: function() {
            var t = this._getSelectables().first();
            return t.length ? t : null
          },
          update: function(e) {
            var t = e !== this.query;
            return t && (this.query = e,
                _.each(this.datasets, function(t) {
                  t.update(e)
                })),
                t
          },
          empty: function() {
            _.each(this.datasets, function(t) {
              t.clear()
            }),
                this.query = null,
                this.$node.addClass(this.classes.empty)
          },
          destroy: function() {
            this.$node.off(".tt"),
                this.$node = b("<div>"),
                _.each(this.datasets, function(t) {
                  t.destroy()
                })
          }
        }),
            t
      }()
          , C = function() {
        "use strict";
        var e = A.prototype;
        function t() {
          A.apply(this, [].slice.call(arguments, 0))
        }
        return _.mixin(t.prototype, A.prototype, {
          open: function() {
            return !this._allDatasetsEmpty() && this._show(),
                e.open.apply(this, [].slice.call(arguments, 0))
          },
          close: function() {
            return this._hide(),
                e.close.apply(this, [].slice.call(arguments, 0))
          },
          _onRendered: function() {
            return this._allDatasetsEmpty() ? this._hide() : this.isOpen() && this._show(),
                e._onRendered.apply(this, [].slice.call(arguments, 0))
          },
          _onCleared: function() {
            return this._allDatasetsEmpty() ? this._hide() : this.isOpen() && this._show(),
                e._onCleared.apply(this, [].slice.call(arguments, 0))
          },
          setLanguageDirection: function(t) {
            return this.$node.css("ltr" === t ? this.css.ltr : this.css.rtl),
                e.setLanguageDirection.apply(this, [].slice.call(arguments, 0))
          },
          _hide: function() {
            this.$node.hide()
          },
          _show: function() {
            this.$node.css("display", "block")
          }
        }),
            t
      }()
          , S = function() {
        "use strict";
        function t(t, e) {
          var n, i, r, s, o, a, l, u, c, h, f;
          (t = t || {}).input || b.error("missing input"),
          t.menu || b.error("missing menu"),
          t.eventBus || b.error("missing event bus"),
              e.mixin(this),
              this.eventBus = t.eventBus,
              this.minLength = _.isNumber(t.minLength) ? t.minLength : 1,
              this.input = t.input,
              this.menu = t.menu,
              this.enabled = !0,
              this.active = !1,
          this.input.hasFocus() && this.activate(),
              this.dir = this.input.getLangDir(),
              this._hacks(),
              this.menu.bind().onSync("selectableClicked", this._onSelectableClicked, this).onSync("asyncRequested", this._onAsyncRequested, this).onSync("asyncCanceled", this._onAsyncCanceled, this).onSync("asyncReceived", this._onAsyncReceived, this).onSync("datasetRendered", this._onDatasetRendered, this).onSync("datasetCleared", this._onDatasetCleared, this),
              n = p(this, "activate", "open", "_onFocused"),
              i = p(this, "deactivate", "_onBlurred"),
              r = p(this, "isActive", "isOpen", "_onEnterKeyed"),
              s = p(this, "isActive", "isOpen", "_onTabKeyed"),
              o = p(this, "isActive", "_onEscKeyed"),
              a = p(this, "isActive", "open", "_onUpKeyed"),
              l = p(this, "isActive", "open", "_onDownKeyed"),
              u = p(this, "isActive", "isOpen", "_onLeftKeyed"),
              c = p(this, "isActive", "isOpen", "_onRightKeyed"),
              h = p(this, "_openIfActive", "_onQueryChanged"),
              f = p(this, "_openIfActive", "_onWhitespaceChanged"),
              this.input.bind().onSync("focused", n, this).onSync("blurred", i, this).onSync("enterKeyed", r, this).onSync("tabKeyed", s, this).onSync("escKeyed", o, this).onSync("upKeyed", a, this).onSync("downKeyed", l, this).onSync("leftKeyed", u, this).onSync("rightKeyed", c, this).onSync("queryChanged", h, this).onSync("whitespaceChanged", f, this).onSync("langDirChanged", this._onLangDirChanged, this)
        }
        return _.mixin(t.prototype, {
          _hacks: function() {
            var r, s;
            r = this.input.$input || b("<div>"),
                s = this.menu.$node || b("<div>"),
                r.on("blur.tt", function(t) {
                  var e, n, i;
                  e = document.activeElement,
                      n = s.is(e),
                      i = 0 < s.has(e).length,
                  _.isMsie() && (n || i) && (t.preventDefault(),
                      t.stopImmediatePropagation(),
                      _.defer(function() {
                        r.focus()
                      }))
                }),
                s.on("mousedown.tt", function(t) {
                  t.preventDefault()
                })
          },
          _onSelectableClicked: function(t, e) {
            this.select(e)
          },
          _onDatasetCleared: function() {
            this._updateHint()
          },
          _onDatasetRendered: function(t, e, n, i) {
            this._updateHint(),
                this.eventBus.trigger("render", n, i, e)
          },
          _onAsyncRequested: function(t, e, n) {
            this.eventBus.trigger("asyncrequest", n, e)
          },
          _onAsyncCanceled: function(t, e, n) {
            this.eventBus.trigger("asynccancel", n, e)
          },
          _onAsyncReceived: function(t, e, n) {
            this.eventBus.trigger("asyncreceive", n, e)
          },
          _onFocused: function() {
            this._minLengthMet() && this.menu.update(this.input.getQuery())
          },
          _onBlurred: function() {
            this.input.hasQueryChangedSinceLastFocus() && this.eventBus.trigger("change", this.input.getQuery())
          },
          _onEnterKeyed: function(t, e) {
            var n;
            (n = this.menu.getActiveSelectable()) && this.select(n) && e.preventDefault()
          },
          _onTabKeyed: function(t, e) {
            var n;
            (n = this.menu.getActiveSelectable()) ? this.select(n) && e.preventDefault() : (n = this.menu.getTopSelectable()) && this.autocomplete(n) && e.preventDefault()
          },
          _onEscKeyed: function() {
            this.close()
          },
          _onUpKeyed: function() {
            this.moveCursor(-1)
          },
          _onDownKeyed: function() {
            this.moveCursor(1)
          },
          _onLeftKeyed: function() {
            "rtl" === this.dir && this.input.isCursorAtEnd() && this.autocomplete(this.menu.getTopSelectable())
          },
          _onRightKeyed: function() {
            "ltr" === this.dir && this.input.isCursorAtEnd() && this.autocomplete(this.menu.getTopSelectable())
          },
          _onQueryChanged: function(t, e) {
            this._minLengthMet(e) ? this.menu.update(e) : this.menu.empty()
          },
          _onWhitespaceChanged: function() {
            this._updateHint()
          },
          _onLangDirChanged: function(t, e) {
            this.dir !== e && (this.dir = e,
                this.menu.setLanguageDirection(e))
          },
          _openIfActive: function() {
            this.isActive() && this.open()
          },
          _minLengthMet: function(t) {
            return (t = _.isString(t) ? t : this.input.getQuery() || "").length >= this.minLength
          },
          _updateHint: function() {
            var t, e, n, i, r, s;
            t = this.menu.getTopSelectable(),
                e = this.menu.getSelectableData(t),
                n = this.input.getInputValue(),
                !e || _.isBlankString(n) || this.input.hasOverflow() ? this.input.clearHint() : (i = x.normalizeQuery(n),
                    r = _.escapeRegExChars(i),
                (s = new RegExp("^(?:" + r + ")(.+$)","i").exec(e.val)) && this.input.setHint(n + s[1]))
          },
          isEnabled: function() {
            return this.enabled
          },
          enable: function() {
            this.enabled = !0
          },
          disable: function() {
            this.enabled = !1
          },
          isActive: function() {
            return this.active
          },
          activate: function() {
            return !!this.isActive() || !(!this.isEnabled() || this.eventBus.before("active")) && (this.active = !0,
                this.eventBus.trigger("active"),
                !0)
          },
          deactivate: function() {
            return !this.isActive() || !this.eventBus.before("idle") && (this.active = !1,
                this.close(),
                this.eventBus.trigger("idle"),
                !0)
          },
          isOpen: function() {
            return this.menu.isOpen()
          },
          open: function() {
            return this.isOpen() || this.eventBus.before("open") || (this.menu.open(),
                this._updateHint(),
                this.eventBus.trigger("open")),
                this.isOpen()
          },
          close: function() {
            return this.isOpen() && !this.eventBus.before("close") && (this.menu.close(),
                this.input.clearHint(),
                this.input.resetInputValue(),
                this.eventBus.trigger("close")),
                !this.isOpen()
          },
          setVal: function(t) {
            this.input.setQuery(_.toStr(t))
          },
          getVal: function() {
            return this.input.getQuery()
          },
          select: function(t) {
            var e = this.menu.getSelectableData(t);
            return !(!e || this.eventBus.before("select", e.obj)) && (this.input.setQuery(e.val, !0),
                this.eventBus.trigger("select", e.obj),
                this.close(),
                !0)
          },
          autocomplete: function(t) {
            var e, n;
            return e = this.input.getQuery(),
            !(!((n = this.menu.getSelectableData(t)) && e !== n.val) || this.eventBus.before("autocomplete", n.obj)) && (this.input.setQuery(n.val),
                this.eventBus.trigger("autocomplete", n.obj),
                !0)
          },
          moveCursor: function(t) {
            var e, n, i, r;
            return e = this.input.getQuery(),
                n = this.menu.selectableRelativeToCursor(t),
                r = (i = this.menu.getSelectableData(n)) ? i.obj : null,
            !(this._minLengthMet() && this.menu.update(e)) && !this.eventBus.before("cursorchange", r) && (this.menu.setCursor(n),
                i ? this.input.setInputValue(i.val) : (this.input.resetInputValue(),
                    this._updateHint()),
                this.eventBus.trigger("cursorchange", r),
                !0)
          },
          destroy: function() {
            this.input.destroy(),
                this.menu.destroy()
          }
        }),
            t;
        function p(n) {
          var t = [].slice.call(arguments, 1);
          return function() {
            var e = [].slice.call(arguments);
            _.each(t, function(t) {
              return n[t].apply(n, e)
            })
          }
        }
      }();
      !function() {
        "use strict";
        var t, v, e;
        function i(t, n) {
          t.each(function() {
            var t, e = b(this);
            (t = e.data(v.typeahead)) && n(t, e)
          })
        }
        function y(t) {
          var e;
          return (e = _.isJQuery(t) || _.isElement(t) ? b(t).first() : []).length ? e : null
        }
        t = b.fn.typeahead,
            v = {
              www: "tt-www",
              attrs: "tt-attrs",
              typeahead: "tt-typeahead"
            },
            e = {
              initialize: function(d, g) {
                var m;
                return g = _.isArray(g) ? g : [].slice.call(arguments, 1),
                    m = n((d = d || {}).classNames),
                    this.each(function() {
                      var t, e, n, i, r, s, o, a, l, u, c;
                      _.each(g, function(t) {
                        t.highlight = !!d.highlight
                      }),
                          t = b(this),
                          e = b(m.html.wrapper),
                          n = y(d.hint),
                          i = y(d.menu),
                          r = !1 !== d.hint && !n,
                          s = !1 !== d.menu && !i,
                      r && (h = t,
                          f = m,
                          n = h.clone().addClass(f.classes.hint).removeData().css(f.css.hint).css((p = h,
                              {
                                backgroundAttachment: p.css("background-attachment"),
                                backgroundClip: p.css("background-clip"),
                                backgroundColor: p.css("background-color"),
                                backgroundImage: p.css("background-image"),
                                backgroundOrigin: p.css("background-origin"),
                                backgroundPosition: p.css("background-position"),
                                backgroundRepeat: p.css("background-repeat"),
                                backgroundSize: p.css("background-size")
                              })).prop("readonly", !0).removeAttr("id name placeholder required").attr({
                            autocomplete: "off",
                            spellcheck: "false",
                            tabindex: -1
                          })),
                      s && (i = b(m.html.menu).css(m.css.menu)),
                      n && n.val(""),
                          t = function(t, e) {
                            t.data(v.attrs, {
                              dir: t.attr("dir"),
                              autocomplete: t.attr("autocomplete"),
                              spellcheck: t.attr("spellcheck"),
                              style: t.attr("style")
                            }),
                                t.addClass(e.classes.input).attr({
                                  autocomplete: "off",
                                  spellcheck: !1
                                });
                            try {
                              !t.attr("dir") && t.attr("dir", "auto")
                            } catch (t) {}
                            return t
                          }(t, m),
                      (r || s) && (e.css(m.css.wrapper),
                          t.css(r ? m.css.input : m.css.inputWithNoHint),
                          t.wrap(e).parent().prepend(r ? n : null).append(s ? i : null));
                      var h, f, p;
                      c = s ? C : A,
                          o = new w({
                            el: t
                          }),
                          a = new x({
                            hint: n,
                            input: t
                          },m),
                          l = new c({
                            node: i,
                            datasets: g
                          },m),
                          u = new S({
                            input: a,
                            menu: l,
                            eventBus: o,
                            minLength: d.minLength
                          },m),
                          t.data(v.www, m),
                          t.data(v.typeahead, u)
                    })
              },
              isEnabled: function() {
                var e;
                return i(this.first(), function(t) {
                  e = t.isEnabled()
                }),
                    e
              },
              enable: function() {
                return i(this, function(t) {
                  t.enable()
                }),
                    this
              },
              disable: function() {
                return i(this, function(t) {
                  t.disable()
                }),
                    this
              },
              isActive: function() {
                var e;
                return i(this.first(), function(t) {
                  e = t.isActive()
                }),
                    e
              },
              activate: function() {
                return i(this, function(t) {
                  t.activate()
                }),
                    this
              },
              deactivate: function() {
                return i(this, function(t) {
                  t.deactivate()
                }),
                    this
              },
              isOpen: function() {
                var e;
                return i(this.first(), function(t) {
                  e = t.isOpen()
                }),
                    e
              },
              open: function() {
                return i(this, function(t) {
                  t.open()
                }),
                    this
              },
              close: function() {
                return i(this, function(t) {
                  t.close()
                }),
                    this
              },
              select: function(t) {
                var e = !1
                    , n = b(t);
                return i(this.first(), function(t) {
                  e = t.select(n)
                }),
                    e
              },
              autocomplete: function(t) {
                var e = !1
                    , n = b(t);
                return i(this.first(), function(t) {
                  e = t.autocomplete(n)
                }),
                    e
              },
              moveCursor: function(e) {
                var n = !1;
                return i(this.first(), function(t) {
                  n = t.moveCursor(e)
                }),
                    n
              },
              val: function(e) {
                var n;
                return arguments.length ? (i(this, function(t) {
                  t.setVal(e)
                }),
                    this) : (i(this.first(), function(t) {
                  n = t.getVal()
                }),
                    n)
              },
              destroy: function() {
                return i(this, function(t, e) {
                  var n, i, r;
                  i = (n = e).data(v.www),
                      r = n.parent().filter(i.selectors.wrapper),
                      _.each(n.data(v.attrs), function(t, e) {
                        _.isUndefined(t) ? n.removeAttr(e) : n.attr(e, t)
                      }),
                      n.removeData(v.typeahead).removeData(v.www).removeData(v.attr).removeClass(i.classes.input),
                  r.length && (n.detach().insertAfter(r),
                      r.remove()),
                      t.destroy()
                }),
                    this
              }
            },
            b.fn.typeahead = function(t) {
              return e[t] ? e[t].apply(this, [].slice.call(arguments, 1)) : e.initialize.apply(this, arguments)
            }
            ,
            b.fn.typeahead.noConflict = function() {
              return b.fn.typeahead = t,
                  this
            }
      }()
    });
//# sourceMappingURL=m-kit-jquery.min.js.map
